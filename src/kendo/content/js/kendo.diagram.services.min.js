/*
* Kendo UI Complete v2013.3.1316 (http://kendoui.com)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(define){return define(["./kendo.diagram.svg.min"],function(){!function(t,i){function e(t,i){t.isSelected?i.ctrlKey&&t.select(!1):t.diagram.select(t,{addToSelection:i.ctrlKey})}function n(t,i){return i.charCodeAt(0)==t||i.toUpperCase().charCodeAt(0)==t}var o,s,r,h,a,c,d,u,l,f,p,v,g,m,_,S,x,w,y,C,b,T,k,A,I,z,P,R,M,B,E,U,L,H=window.kendo,D=H.diagram,K=H.Class,W=D.Group,V=D.TextBlock,N=D.Rect,O=D.Rectangle,G=D.Utils,F=D.Point,j=D.Circle,Q=D.Path,q=H.deepExtend,J={arrow:"default",grip:"pointer",cross:"pointer",add:"pointer",move:"move",select:"pointer"},X=10,Y="Auto",Z="Top",$="Right",ti="Left",ii="Bottom",ei=[Z,$,ii,ti,Y],ni=1.1;D.Cursors=J,o=K.extend({init:function(t,i,e){this.animate=G.isUndefined(e)?!1:e,this._initialState=t,this._finalState=i,this.title="Diagram layout"},undo:function(){this.setState(this._initialState)},redo:function(){this.setState(this._finalState)},setState:function(t){var i,e=t.diagram;this.animate?(t.linkMap.forEach(function(t,i){var n=e.getId(t);n.visible(!1),n&&n.points(i)}),i=new H.diagram.Ticker,i.addAdapter(new H.diagram.PositionAdapter(t)),i.onComplete(function(){t.linkMap.forEach(function(t){var i=e.getId(t);i.visible(!0)})}),i.play()):(t.nodeMap.forEach(function(t,i){var n=e.getId(t);n&&n.position(i.topLeft())}),t.linkMap.forEach(function(t,i){var n=e.getId(t);n&&n.points(i)}))}}),s=K.extend({init:function(t){this.units=[],this.title="Composite unit",t!==i&&this.units.push(t)},add:function(t){this.units.push(t)},undo:function(){for(var t=0;t<this.units.length;t++)this.units[t].undo()},redo:function(){for(var t=0;t<this.units.length;t++)this.units[t].redo()}}),r=K.extend({init:function(t,i,e){this.item=t,this._undoContent=i,this._redoContent=e,this.title="Content Editing"},undo:function(){this.item.content(this._undoContent)},redo:function(){this.item.content(this._redoContent)}}),h=K.extend({init:function(t,i,e){this.item=t,this._redoSource=i,this._redoTarget=e,this._undoSource=t.source(),this._undoTarget=t.target(),this.title="Connection Editing"},undo:function(){this._undoSource!==i&&this.item.source(this._undoSource,!1),this._undoTarget!==i&&this.item.target(this._undoTarget,!1)},redo:function(){this._redoSource!==i&&this.item.source(this._redoSource,!1),this._redoTarget!==i&&this.item.target(this._redoTarget,!1)}}),a=K.extend({init:function(t,i,e){this.item=t,this._undoSource=i,this._undoTarget=e,this._redoSource=t.source(),this._redoTarget=t.target(),this.title="Connection Editing"},undo:function(){this.item.source(this._undoSource,!1),this.item.target(this._undoTarget,!1)},redo:function(){this.item.source(this._redoSource,!1),this.item.target(this._redoTarget,!1)}}),c=K.extend({init:function(t){this.connection=t,this.diagram=t.diagram,this.targetConnector=t.targetConnector,this.title="Delete connection"},undo:function(){this.diagram.addConnection(this.connection,!1)},redo:function(){this.diagram.remove(this.connection,!1)}}),d=K.extend({init:function(t){this.shape=t,this.diagram=t.diagram,this.title="Deletion"},undo:function(){this.diagram.addShape(this.shape,{undoable:!1}),this.shape.select(!1)},redo:function(){this.shape.select(!1),this.diagram.remove(this.shape,!1)}}),u=K.extend({init:function(t,i){var e,n;for(this.shapes=t,this.undoStates=i,this.title="Transformation",this.redoStates=[],e=0;e<this.shapes.length;e++)n=this.shapes[e],this.redoStates.push(n.bounds())},undo:function(){var t,i;for(t=0;t<this.shapes.length;t++)i=this.shapes[t],i.bounds(this.undoStates[t]),i.refresh()},redo:function(){var t,i;for(t=0;t<this.shapes.length;t++)i=this.shapes[t],i.bounds(this.redoStates[t]),i.refresh()}}),l=K.extend({init:function(t,i){this.connection=t,this.diagram=i,this.title="New connection"},undo:function(){this.diagram.remove(this.connection,!1)},redo:function(){this.diagram.addConnection(this.connection,!1)}}),f=K.extend({init:function(t,i){this.shape=t,this.diagram=i,this.title="New shape"},undo:function(){this.diagram.remove(this.shape,!1)},redo:function(){this.diagram.addShape(this.shape,{undoable:!1})}}),p=K.extend({init:function(t,i,e){this.initial=t,this.final=i,this.diagram=e,this.title="Pan Unit"},undo:function(){this.diagram.pan(this.initial)},redo:function(){this.diagram.pan(this.final)}}),v=K.extend({init:function(t,i,e,n){var o,s;for(this.shapes=i,this.undoRotates=e,this.title="Rotation",this.redoRotates=[],this.redoAngle=t._angle,this.undoAngle=n,this.adorner=t,this.center=t._innerBounds.center(),o=0;o<this.shapes.length;o++)s=this.shapes[o],this.redoRotates.push(s.rotate().angle)},undo:function(){var t,i;for(t=0;t<this.shapes.length;t++)i=this.shapes[t],i.rotate(this.undoRotates[t],this.center);this.adorner._angle=this.undoAngle,this.adorner.refresh()},redo:function(){var t,i;for(t=0;t<this.shapes.length;t++)i=this.shapes[t],i.rotate(this.redoRotates[t],this.center);this.adorner._angle=this.redoAngle,this.adorner.refresh()}}),g=K.extend({init:function(t,i,e){this.diagram=t,this.indices=e,this.items=i,this.title="Rotate Unit"},undo:function(){this.diagram._toIndex(this.items,this.indices)},redo:function(){this.diagram.toFront(this.items,!1)}}),m=K.extend({init:function(t,i,e){this.diagram=t,this.indices=e,this.items=i,this.title="Rotate Unit"},undo:function(){this.diagram._toIndex(this.items,this.indices)},redo:function(){this.diagram.toBack(this.items,!1)}}),_=K.extend({init:function(){this.stack=[],this.index=0,this.capacity=100},begin:function(){this.composite=new s},cancel:function(){this.composite=i},commit:function(){this.composite.units.length>0&&this._restart(this.composite),this.composite=i},addCompositeItem:function(t){this.composite?this.composite.add(t):this.add(t)},add:function(t,i){this._restart(t,i)},count:function(){return this.stack.length},undo:function(){this.index>0&&(this.index--,this.stack[this.index].undo())},redo:function(){this.stack.length>0&&this.index<this.stack.length&&(this.stack[this.index].redo(),this.index++)},_restart:function(t,i){this.stack.splice(this.index,this.stack.length-this.index),this.stack.push(t),G.isUndefined(i)||i&&i===!0?this.redo():this.index++,this.stack.length>this.capacity&&(this.stack.splice(0,this.stack.length-this.capacity),this.index=this.capacity)},clear:function(){this.stack=[],this.index=0}}),S=K.extend({init:function(t){this.toolService=t},start:function(){},move:function(){},end:function(){},doubleClick:function(){},tryActivate:function(){return!1},getCursor:function(){return J.arrow}}),x=S.extend({init:function(t){S.fn.init.call(this,t)},tryActivate:function(t){return this.toolService.hoveredItem===i&&t.ctrlKey},start:function(t){this.toolService.isPanning=!0,this.panStart=this.toolService.diagram._pan,this.panOffset=t,this.panDelta=new F},move:function(t){var i=this.toolService.diagram;this.panDelta=t.plus(this.panDelta).minus(this.panOffset),i.pan(this.panStart.plus(this.panDelta))},end:function(){var t=this.toolService.diagram;t.undoRedoService.begin(),t.undoRedoService.add(new p(this.panStart,t._pan,t)),t.undoRedoService.commit(),this.toolService.isPanning=!1},getCursor:function(){return J.move}}),w=K.extend({init:function(t){this.toolService=t},tryActivate:function(){return!0},start:function(t,i){var n=this.toolService.diagram,o=this.toolService.hoveredItem;o&&(e(o,i),o.adorner&&(this.adorner=o.adorner,this.handle=this.adorner._hitTest(t))),this.handle||(this.handle=n.resizingAdorner._hitTest(t),this.handle&&(this.adorner=n.resizingAdorner)),this.adorner&&this.adorner.start(t)},move:function(t){var e=this;return this.adorner?(this.adorner.move(e.handle,t),!0):i},end:function(){var t,e=this.toolService.diagram;this.adorner&&(e.undoRedoService.begin(),t=this.adorner.stop(),t&&e.undoRedoService.addCompositeItem(t),e.undoRedoService.commit()),this.adorner=i,this.handle=i},getCursor:function(t){return this.toolService.hoveredItem?this.toolService.hoveredItem._getCursor(t):J.arrow}}),y=K.extend({init:function(t){this.toolService=t},tryActivate:function(){return this.toolService.hoveredItem===i&&this.toolService.hoveredAdorner===i},start:function(t){var i=this.toolService.diagram;i.select(!1),i.selector.start(t)},move:function(t){var i=this.toolService.diagram;i.selector.move(t)},end:function(t,i){var e=this.toolService.diagram,n=this.toolService.hoveredItem,o=e.selector.bounds();n&&n.isSelected||i.ctrlKey||e.select(!1),o.isEmpty()||e.select(o),e.selector.end()},getCursor:function(){return J.arrow}}),C=K.extend({init:function(t){this.toolService=t,this.type="ConnectionTool"},tryActivate:function(t){return this.toolService._hoveredConnector&&!t.ctrlKey},start:function(t,i){var n=this.toolService.diagram,o=this.toolService._hoveredConnector,s=n.connect(o._c,t);this.toolService._connectionManipulation(s,o._c.shape,!0),this.toolService._removeHover(),e(this.toolService.activeConnection,i)},move:function(t){return this.toolService.activeConnection.target(t),!0},end:function(){var t=this.toolService.activeConnection,i=this.toolService.hoveredItem,e=this.toolService._hoveredConnector;e&&e._c!=t.sourceConnector?t.target(e._c):i&&t.target(i),this.toolService._connectionManipulation()},getCursor:function(){return J.arrow}}),b=K.extend({init:function(t){this.toolService=t,this.type="ConnectionTool"},tryActivate:function(){var t=this.toolService.hoveredItem,i=t&&t.path;return i&&(this._c=t),i},start:function(t,i){e(this._c,i),this.handle=this._c.adorner._hitTest(t),this._c.adorner.start(t)},move:function(t){return this._c.adorner.move(this.handle,t),!0},end:function(t){var i=this._c.adorner.stop(t);this.toolService.diagram.undoRedoService.begin(),this.toolService.diagram.undoRedoService.add(i),this.toolService.diagram.undoRedoService.commit()},getCursor:function(){return J.move}}),T=S.extend({init:function(i){S.fn.init.call(this,i),this.editor=new D.TextBlockEditor,this.editor.bind("finishEdit",t.proxy(this._finishEdit,this)),this.toolService.diagram.bind("zoom",t.proxy(this._positionEditor,this))},doubleClick:function(){var t,i=this.editor,e=this.toolService.hoveredItem;this.toolService.editable=i,this.toolService.editShape=e,this._showEditor(),t=e.content(),e.content(""),i.originalContent=t,i.content(t),i.focus()},tryActivate:function(t){return t.doubleClick&&this.toolService.hoveredItem},_showEditor:function(){var t=this.toolService.diagram,i=this.editor;i.visible(!0),t.element.context.appendChild(i.native),this._positionEditor()},_positionEditor:function(){var i,e,n,o,s,r,h,a,c;this.toolService.editShape&&(i=this.toolService.diagram,e=this.editor,n=t(e.native),o=this.toolService.editShape.bounds(),s=function(t){return parseInt(n.css(t),10)},r=20,h=new F(s("borderLeftWidth")+s("paddingLeft"),s("borderTopWidth")+s("paddingTop")),a=new F(10,o.height/2-r/2).minus(h).times(i.zoom()),e.size((o.width-20)*i.zoom(),r*i.zoom()),c=i.transformPoint(o.topLeft()),e.position(c.plus(a)),n.css({fontSize:15*i.zoom()||0}))},_finishEdit:function(){this.toolService._finishEditShape()}}),k=K.extend({init:function(t){this.diagram=t,this.tools=[new T(this),new x(this),new b(this),new C(this),new y(this),new w(this)],this.activeTool=i},start:function(t,i){return i=q({},i),this._updateHoveredItem(t),this._finishEditShape(),this._activateTool(i),this.activeTool.start(t,i),this._updateCursor(t),this.diagram.focus(),!0},move:function(t,i){i=q({},i);var e=!0;return this.activeTool&&(e=this.activeTool.move(t,i)),e&&this._updateHoveredItem(t),this._updateCursor(t),!0},end:function(t,e){return e=q({},e),this.activeTool&&this.activeTool.end(t,e),this.activeTool=i,this._updateCursor(t),!0},doubleClick:function(t,i){this._activateTool(q(i,{doubleClick:!0})),this.activeTool.doubleClick(t,i),this._updateCursor(t)},keyDown:function(t,i){var e=this.diagram;if(i=q({ctrlKey:!1,metaKey:!1,altKey:!1},i),!i.ctrlKey&&!i.metaKey||i.altKey){if(46===t||8===t)return e.remove(e.select(),!0),!0;if(27===t)return this._discardNewConnection(),e.select(!1),e.refresh(),!0}else{if(n(t,"a"))return e.select("All"),!0;if(n(t,"z"))return e.undo(),!0;if(n(t,"y"))return e.redo(),!0;n(t,"c")?e.copy():n(t,"x")?e.cut():n(t,"v")?e.paste():n(t,"l")?e.layout():n(t,"d")&&(e.copy(),e.paste())}},wheel:function(t,i){var e=this.diagram,n=i.delta,o=e.zoom();return 0>n?o*=ni:o/=ni,e.zoom(o,t),!0},_discardNewConnection:function(){this.newConnection&&(this.diagram.remove(this.newConnection),this.newConnection=i)},_activateTool:function(t){var i,e;for(i=0;i<this.tools.length;i++)if(e=this.tools[i],e.tryActivate(t)){this.activeTool=e;break}},_updateCursor:function(i){var e=this.activeTool?this.activeTool.getCursor(i):this.hoveredItem?this.hoveredItem._getCursor(i):this.hoveredAdorner?this.hoveredAdorner._getCursor(i):J.arrow;t(this.diagram.canvas.native).css({cursor:e})},_connectionManipulation:function(t,e,n){this.activeConnection=t,this.disabledShape=e,this.newConnection=n?this.activeConnection:i},_updateHoveredItem:function(t){var e,n=this._hitTest(t);n==this.hoveredItem||this.disabledShape&&n==this.disabledShape||(this.hoveredItem&&this.hoveredItem._hover(!1),this.hoveredItem=n,this.hoveredItem&&this.hoveredItem._hover(!0)),e=this.diagram.resizingAdorner._hitTest(t),this.hoveredAdorner=e?this.diagram.resizingAdorner:i},_removeHover:function(){this.hoveredItem&&(this.hoveredItem._hover(!1),this.hoveredItem=i)},_hitTest:function(t){var e,n=this.diagram;return n._connectorsAdorner&&(this._hoveredConnector&&(this._hoveredConnector._hover(!1),this._hoveredConnector=i),e=n._connectorsAdorner._hitTest(t))?e:(this.activeTool&&"ConnectionTool"===this.activeTool.type||(e=this._hitTestItems(n._selectedItems,t)),e||this._hitTestItems(n.shapes,t)||this._hitTestItems(n.connections,t))},_hitTestItems:function(t,i){var e,n,o;for(e=t.length-1;e>=0;e--)if(n=t[e],o=n._hitTest(i))return o},_finishEditShape:function(){if(this.editShape){var t=new r(this.editShape,this.editable.originalContent,this.editable.content());this.diagram.undoRedoService.add(t),this.editable.visible(!1),this.editable=this.editShape=i}}}),A=H.Class.extend({init:function(){}}),I=A.extend({init:function(t){var i=this;A.fn.init.call(i),this.connection=t},hitTest:function(t){var i=this.getBounds().inflate(10);return i.contains(t)?H.diagram.Geometry.distanceToPolyline(t,this.connection.allPoints())<X:!1},getBounds:function(){var t,i=this.connection.allPoints(),e=i[0],n=i[i.length-1],o=Math.max(e.x,n.x),s=Math.min(e.x,n.x),r=Math.min(e.y,n.y),h=Math.max(e.y,n.y);for(t=1;t<i.length-1;++t)o=Math.max(o,i[t].x),s=Math.min(s,i[t].x),r=Math.min(r,i[t].y),h=Math.max(h,i[t].y);return new N(s,r,o-s,h-r)}}),z=I.extend({init:function(t){var i=this;I.fn.init.call(i),this.connection=t},route:function(){}}),P=I.extend({init:function(t){var i=this;I.fn.init.call(i),this.connection=t},route:function(){function t(){if(null!==u){if(u===$||u===ti)return!0;if(u===Z||u===ii)return!1}return Math.abs(s.x-r.x)>Math.abs(s.y-r.y)}var i,e,n,o=this.connection,s=this.connection.sourcePoint(),r=this.connection.targetPoint(),h=[s,s,r,r],a=r.x-s.x,c=r.y-s.y,d=h.length,u=null,l=null;if(G.isDefined(o._resolvedSourceConnector)&&(u=o._resolvedSourceConnector.options.name),G.isDefined(o._resolvedTargetConnector)&&(l=o._resolvedTargetConnector.options.name),null!==u&&null!==l&&ei.contains(u)&&ei.contains(l))u===Z||u==ii?l==Z||l==ii?this.connection.points([new F(s.x,s.y+c/2),new F(r.x,s.y+c/2)]):this.connection.points([new F(s.x,s.y+c)]):l==ti||l==$?this.connection.points([new F(s.x+a/2,s.y),new F(s.x+a/2,s.y+c)]):this.connection.points([new F(r.x,s.y)]);else{for(this.connection.cascadeStartHorizontal=t(this.connection),n=1;d-1>n;++n)o.cascadeStartHorizontal?0!==n%2?(i=a/(d/2),e=0):(i=0,e=c/((d-1)/2)):0!==n%2?(i=0,e=c/(d/2)):(i=a/((d-1)/2),e=0),h[n]=new F(h[n-1].x+i,h[n-1].y+e);n--,h[d-2]=o.cascadeStartHorizontal&&0!==n%2||!o.cascadeStartHorizontal&&0===n%2?new F(h[d-1].x,h[d-2].y):new F(h[d-2].x,h[d-1].y),this.connection.points([h[1],h[2]])}}}),R=K.extend({init:function(t,i){var e=this;e.diagram=t,e.options=q({},e.options,i),e.visual=new W,e.diagram.bind("pan",function(){e.refresh()}),e.diagram.bind("zoom",function(){e.refresh()})},refresh:function(){}}),M=R.extend({init:function(t,i){var e,n,o,s=this;s.connection=t,e=s.connection.diagram,s._ts=e.toolService,R.fn.init.call(s,e,i),n=s.connection.sourcePoint(),o=s.connection.targetPoint(),s.spVisual=new j(q(s.options.handles,{center:n})),s.epVisual=new j(q(s.options.handles,{center:o})),s.visual.append(s.spVisual),s.visual.append(s.epVisual)},options:{handles:{width:8,height:8,background:"Red"}},_getCursor:function(){return J.move},start:function(t){switch(this.handle=this._hitTest(t),this.startPoint=t,this._initialSource=this.connection.source(),this._initialTarget=this.connection.target(),this.handle){case-1:this.connection.targetConnector&&this._ts._connectionManipulation(this.connection,this.connection.targetConnector.shape);break;case 1:this.connection.sourceConnector&&this._ts._connectionManipulation(this.connection,this.connection.sourceConnector.shape)}},move:function(t,i){switch(t){case-1:this.connection.source(i);break;case 1:this.connection.target(i);break;default:var e=i.minus(this.startPoint);this.startPoint=i,this.connection.sourceConnector||this.connection.source(this.connection.sourcePoint().plus(e)),this.connection.targetConnector||this.connection.target(this.connection.targetPoint().plus(e))}return this.refresh(),!0},stop:function(t){var e,n=this.diagram.toolService,o=n.hoveredItem;if(e=n._hoveredConnector?n._hoveredConnector._c:o&&!o.line?o:t,this.handle!==i)switch(this.handle){case-1:this.connection.source(e);break;case 1:this.connection.target(e)}return this.handle=i,this._ts._connectionManipulation(),new a(this.connection,this._initialSource,this._initialTarget)},_hitTest:function(t){var i=this.connection.sourcePoint(),e=this.connection.targetPoint(),n=this.options.handles.width/2,o=this.options.handles.height/2,s=new N(i.x,i.y).inflate(n,o),r=new N(e.x,e.y).inflate(n,o);return s.contains(t)?-1:r.contains(t)?1:0},refresh:function(){this.spVisual.redraw({center:this.diagram.transformPoint(this.connection.sourcePoint())}),this.epVisual.redraw({center:this.diagram.transformPoint(this.connection.targetPoint())})}}),B=R.extend({init:function(t,i){var e,n,o,s=this;for(s.shape=t,R.fn.init.call(s,s.shape.diagram,i),o=t.connectors.length,s.connectors=[],n=0;o>n;n++)e=new L(t.connectors[n]),s.connectors.push(e),s.visual.append(e.visual);s.shape.diagram.bind("boundsChange",function(){s.refresh()}),s.refresh()},_hitTest:function(t){var i,e;for(e=0;e<this.connectors.length;e++)if(i=this.connectors[e],i._hitTest(t)){i._hover(!0),this.diagram.toolService._hoveredConnector=i;break}},refresh:function(){var i=this.shape.visualBounds();this.visual.position(i.topLeft()),t.each(this.connectors,function(){this.refresh()})}}),E=R.extend({init:function(t,i){var e,n,o,s=this;if(R.fn.init.call(s,t,i),s._manipulating=!1,s.map=[],this.shapes=[],s.options.resizable)for(e=-1;1>=e;e++)for(n=-1;1>=n;n++)(0!==e||0!==n)&&(o=new O(s.options.handles),s.map.push({x:e,y:n,visual:o}),s.visual.append(o));s.text=new V,s.visual.append(s.text),s.rect=new O(s.options.rect),s.visual.append(s.rect),s.options.rotatable&&(s.rotationThumb=new Q(s.options.rotationThumb),s.visual.append(s.rotationThumb)),s.diagram.bind("select",function(t){s._initialize(t.items)}),s._refreshHandler=function(){s.refresh()},s._rotatedHandler=function(){1==s.shapes.length&&(s._angle=s.shapes[0].rotate().angle),s.refresh()},s.diagram.bind("boundsChange",s._refreshHandler).bind("rotate",s._rotatedHandler),s.refresh()},options:{resizable:!0,rotatable:!0,handles:{width:7,height:7,background:"DimGray"},rect:{stroke:"#778899",strokeThickness:1,strokeWidth:1,strokeDashArray:"2, 2",background:"none"},rotationThumb:{data:"M6.50012,0C8.21795,2.56698e-009 9.78015,0.666358 10.9423,1.75469L11.0482,1.85645L12.6557,0.541992L12.697,6.41699L7,5.16667L8.69918,3.77724L8.68162,3.76281C8.08334,3.28539 7.32506,3 6.50012,3C4.56709,3 3.00006,4.567 3.00006,6.5C3.00006,8.433 4.56709,10 6.50012,10C7.82908,10 8.98505,9.25935 9.57775,8.16831L9.59433,8.13594L12.333,9.37087L12.2891,9.45914C11.2124,11.5613 9.02428,13 6.50012,13C2.9102,13 -7.45058e-008,10.0899 0,6.5C-7.45058e-008,2.91015 2.9102,2.93369e-009 6.50012,0z",y:-50,thumbWidth:10},offset:6},bounds:function(t){return t?(this._innerBounds=t.clone(),this._bounds=this.diagram.transformRect(t).inflate(this.options.offset,this.options.offset),i):this._bounds},_hitTest:function(t){var e,n,o,s,r=this.diagram.transformPoint(t),h=this.map.length;if(this._angle&&(r=r.clone().rotate(this._bounds.center(),this._angle)),this.options.rotatable&&this._rotationThumbBounds&&this._rotationThumbBounds.contains(r))return new F(-1,-2);if(this.options.resizable)for(e=0;h>e;e++)if(s=this.map[e],n=new F(s.x,s.y),o=this._getHandleBounds(n),o.offset(this._bounds.x,this._bounds.y),o.contains(r))return n;return this._bounds.contains(r)?new F(0,0):i},_getHandleBounds:function(t){var i=this.options.handles.width,e=this.options.handles.height,n=new N(0,0,i,e);return t.x<0?n.x=-i:0===t.x?n.x=Math.floor(this._bounds.width/2)-i/2:t.x>0&&(n.x=this._bounds.width+1),t.y<0?n.y=-e:0===t.y?n.y=Math.floor(this._bounds.height/2)-e/2:t.y>0&&(n.y=this._bounds.height+1),n},_getCursor:function(t){var i,e=this._hitTest(t);if(e&&e.x>=-1&&e.x<=1&&e.y>=-1&&e.y<=1&&this.options.resizable){if(i=this._angle,i&&(i=360-i,e.rotate(new F(0,0),i),e=new F(Math.round(e.x),Math.round(e.y))),-1==e.x&&-1==e.y)return"nw-resize";if(1==e.x&&1==e.y)return"se-resize";if(-1==e.x&&1==e.y)return"sw-resize";if(1==e.x&&-1==e.y)return"ne-resize";if(0===e.x&&-1==e.y)return"n-resize";if(0===e.x&&1==e.y)return"s-resize";if(1==e.x&&0===e.y)return"e-resize";if(-1==e.x&&0===e.y)return"w-resize"}return this._manipulating?J.move:J.select},_initialize:function(t){var i,e,n=this;for(n.shapes=[],i=0;i<t.length;i++)e=t[i],e instanceof D.Shape&&(n.shapes.push(e),e._rotationOffset=new F);n._angle=1==n.shapes.length?n.shapes[0].rotate().angle:0,n._startAngle=n._angle,n._rotates(),n._positions(),n.refresh()},_rotates:function(){var t,i,e=this;for(e.initialRotates=[],t=0;t<e.shapes.length;t++)i=e.shapes[t],e.initialRotates.push(i.rotate().angle)},_positions:function(){var t,i,e=this;for(e.initialStates=[],t=0;t<e.shapes.length;t++)i=e.shapes[t],e.initialStates.push(i.bounds())},start:function(t){var i,e;for(this._sp=t,this._cp=t,this._manipulating=!0,this.shapeStates=[],i=0;i<this.shapes.length;i++)e=this.shapes[i],this.shapeStates.push(e.bounds());this._initialAngle=this._angle},move:function(t,i){var e,n,o,s,r,h,a,c=i.minus(this._cp),d=new F,u=new F;if(-2===t.y&&-1===t.x)for(o=this._innerBounds.center(),this._angle=Math.findAngle(o,i),r=0;r<this.shapes.length;r++)s=this.shapes[r],h=(this._angle+this.initialRotates[r]-this._startAngle)%360,s.rotate(h,o),this._rotated=!0;else{for(0===t.x&&0===t.y?(u=d=c,e=!0):(this._angle&&c.rotate(new F(0,0),this._angle),-1==t.x?d.x=c.x:1==t.x&&(u.x=c.x),-1==t.y?d.y=c.y:1==t.y&&(u.y=c.y)),r=0;r<this.shapes.length;r++)s=this.shapes[r],n=s.bounds(),a=this._displaceBounds(n,d,u,e),a.width>=s.options.minWidth&&a.height>=s.options.minHeight&&(s.bounds(a),s.rotate(s.rotate().angle));this._positions()}this._cp=i},_displaceBounds:function(t,i,e,n){var o,s=t.topLeft().plus(i),r=t.bottomRight().plus(e),h=N.fromPoints(s,r);return n||(o=h.center(),o.rotate(t.center(),360-this._angle),h=new N(o.x-h.width/2,o.y-h.height/2,h.width,h.height)),h},stop:function(){var t;return this._cp!=this._sp&&(t=this._rotated?new v(this,this.shapes,this.initialRotates,this._initialAngle):new u(this.shapes,this.shapeStates)),this._manipulating=i,this._rotated=i,t},_hover:function(){},refresh:function(){var i,e,n=this,o=1==this.shapes.length?this.shapes[0].bounds().clone():this.diagram.getOriginBoundingBox(this.shapes);this.bounds(o),o=this.bounds(),this.shapes.length>0?(this.visual.visible(!0),this.visual.position(o.topLeft()),t.each(this.map,function(){i=n._getHandleBounds(new F(this.x,this.y)),this.visual.position(i.topLeft())}),this.text.position(new F(0,o.height+20)),this.text.content(H.format("x: {0}, y: {1}, w: {2}, h: {3} a: {4}",Math.round(o.x),Math.round(o.y),Math.round(o.width),Math.round(o.height),Math.round(this._angle))),this.visual.position(o.topLeft()),e=new F(o.width/2,o.height/2),this.visual.rotate(this._angle,e),this.rect.redraw({width:o.width,height:o.height}),this.rotationThumb&&(this._rotationThumbBounds=new N(o.center().x,o.y+this.options.rotationThumb.y,0,0).inflate(this.options.rotationThumb.thumbWidth),this.rotationThumb.redraw({x:o.width/2-this.options.rotationThumb.thumbWidth/2}))):this.visual.visible(!1)}}),U=K.extend({init:function(t){this.visual=new O(this.options),this.diagram=t},options:{stroke:"#778899",strokeThickness:1,strokeWidth:1,strokeDashArray:"2, 2",background:"none"},start:function(t){this._sp=this._ep=t,this.refresh(),this.diagram._adorn(this,!0)},end:function(){this._sp=this._ep=i,this.diagram._adorn(this,!1)},bounds:function(t){return t&&(this._bounds=t),this._bounds},move:function(t){this._ep=t,this.refresh()},refresh:function(){var t=N.fromPoints(this.diagram.transformPoint(this._sp),this.diagram.transformPoint(this._ep));this.bounds(N.fromPoints(this._sp,this._ep)),this.visual.position(t.topLeft()),this.visual.redraw({height:t.height+1,width:t.width+1})}}),L=K.extend({init:function(t){this.options=q({},t.options),this._c=t,this.visual=new j(this.options),this.refresh(),this.visual.setAtr("class","cssClass")},_hover:function(t){this.visual.background(t?this.options.hoveredBackground:this.options.background)},refresh:function(){var t=this._c.shape.diagram.transformPoint(this._c.position()),i=t.minus(this._c.shape.visualBounds().topLeft()),e=new N(t.x,t.y,0,0);e.inflate(this.options.width/2,this.options.height/2),this._visualBounds=e,this.visual.redraw({center:new F(i.x,i.y)})},_hitTest:function(t){var i=this._c.shape.diagram.transformPoint(t);return this._visualBounds.contains(i)}}),q(D,{CompositeUnit:s,TransformUnit:u,PanUndoUnit:p,AddShapeUnit:f,AddConnectionUnit:l,DeleteShapeUnit:d,DeleteConnectionUnit:c,ContentChangedUndoUnit:r,ConnectionEditAdorner:M,UndoRedoService:_,ResizingAdorner:E,Selector:U,ToolService:k,ConnectorsAdorner:B,LayoutUndoUnit:o,ConnectionEditUnit:h,ToFrontUnit:g,ToBackUnit:m,ConnectionRouterBase:A,PolylineRouter:z,CascadingRouter:P})}(window.kendo.jQuery)})}("function"==typeof define&&define.amd?define:function(t,i){return i()});
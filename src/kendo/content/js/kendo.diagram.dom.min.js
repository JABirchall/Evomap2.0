/*
* Kendo UI Complete v2013.3.1316 (http://kendoui.com)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(define){return define(["./kendo.diagram.svg.min","./kendo.diagram.services.min","./kendo.data.min","./kendo.draganddrop.min"],function(){!function(t,e){function n(t){var e,n,o,s,r,h,c,u,d,l,f=se,p=t.source(),m=t.target(),g=[0,2,3,1,4];if(p instanceof I?e=p:p instanceof a&&(p.options.name===$?o=p.shape:(t._resolvedSourceConnector=p,e=p.position())),m instanceof I?n=m:m instanceof a&&(m.options.name===$?s=m.shape:(t._resolvedTargetConnector=m,n=m.position())),e)s&&(t._resolvedTargetConnector=i(e,s));else if(o)if(n)t._resolvedSourceConnector=i(n,o);else if(s)for(c=0;c<o.connectors.length;c++)h=5==o.connectors.length?g[c]:c,r=o.connectors[h],r.options.name!==$&&(u=r.position(),d=i(u,s),l=Math.round(d.position().distanceTo(u)),f>l&&(f=l,t._resolvedSourceConnector=r,t._resolvedTargetConnector=d))}function i(t,e){var n,i,o,s,r=se,a=e.connectors;for(i=0;i<a.length;i++)o=a[i],o.options.name!==$&&(s=t.distanceTo(o.position()),r>s&&(r=s,n=o));return n}function o(t,e){var n,i,o,s,r=[];for(n=0;n<e.length;n++)for(i=e[n],o=0;o<t.children.length;o++)if(s=t.children[o],s==i.native){r.push(o);break}return r}function s(t,n){var i,o=I.parse(n);return o?o:(i=a.parse(t,n),i?i:e)}var r,a,h,c,u,d,l=window.kendo,f=l.diagram,p=l.ui,m=p.Widget,g=l.Class,v=t.proxy,_=l.deepExtend,w=l.data.HierarchicalDataSource,y=f.Canvas,C=f.Group,b=f.Rectangle,S=f.Circle,P=f.CompositeTransform,x=f.Rect,D=f.Path,L=f.DeleteShapeUnit,k=f.DeleteConnectionUnit,T=f.TextBlock,I=f.Point,A=f.Intersect,U=f.ConnectionEditAdorner,V=f.UndoRedoService,R=f.ToolService,B=f.Selector,z=f.ResizingAdorner,O=f.ConnectorsAdorner,F=f.Cursors,M=f.Utils,E=l.Observable,H=f.Ticker,K=f.ToBackUnit,G=f.ToFrontUnit,X=f.Dictionary,Y=f.PolylineRouter,Z=f.CascadingRouter,N=".kendoDiagram",W="Cascading",j="Polyline",q="boundsChange",Q="change",J="error",$="Auto",te="Top",ee="Right",ne="Left",ie="Bottom",oe={text:"dataTextField",url:"dataUrlField",spriteCssClass:"dataSpriteCssClassField",imageUrl:"dataImageUrlField"},se=9007199254740992,re="select",ae="rotate",he="pan",ce="zoom",ue=100,de=100;f.DefaultConnectors=[{name:te,description:"Top Connector"},{name:ee,description:"Right Connector"},{name:ie,description:"Bottom Connector"},{name:ne,Description:"Left Connector"},{name:$,Description:"Auto Connector",position:function(t){return t.getPosition("center")}}],r=l.Class.extend({init:function(t){this.pan=t.pan,this.diagram=t.diagram},initState:function(){this.from=this.diagram.pan(),this.to=this.pan},update:function(t){this.diagram.pan(new I(this.from.x+(this.to.x-this.from.x)*t,this.from.y+(this.to.y-this.from.y)*t))}}),a=g.extend({init:function(t,e){this.options=_({},this.options,e),this.connections=[],this.shape=t},options:{width:8,height:8,background:"Yellow",hoveredBackground:"#70CAFF",cssClass:"connector"},position:function(){return this.options.position?this.options.position(this.shape):this.shape.getPosition(this.options.name)},toString:function(){return l.format("{0}: {1}",""+this.shape,this.options.name)}}),a.parse=function(t,e){var n,i,o=e.split(":"),s=o[0],r=o[1]||$;for(n=0;n<t.shapes.length;n++)if(i=t.shapes[n],i.options.id==s)return i.getConnector(r.trim())},h=E.extend({init:function(t,n){var i=this;E.fn.init.call(i),i.options=_({id:l.diagram.randomId()},i.options,t),i.isSelected=!1,i.model=n,i.visual=new C({id:i.options.id,cssClass:i.options.cssClass}),i.options.cssClass=e,i._template()},options:{background:"Green",hoveredBackground:"#70CAFF",cursor:F.grip},_getCursor:function(t){return this.adorner?this.adorner._getCursor(t):F.select},visible:function(t){return M.isUndefined(t)?this.visual.visible():(this.visual.visible(t),e)},bounds:function(){},refresh:function(){this.visual.redraw()},position:function(t){this.options.x=t.x,this.options.y=t.y,this.visual.position(t)},toString:function(){return this.options.id},serialize:function(){var t=_({},{options:this.options});return this.model&&(t.model=""+this.model),t},content:function(t){if(t!==e)if(t){var n=this.bounds();this.contentVisual&&this.contentVisual instanceof T?this.contentVisual.options.text=""+t:(this.contentVisual=new T({text:""+t,align:"center middle",x:n.x,y:n.y,width:n.width,height:n.height}),this.visual.append(this.contentVisual)),this.options.content=""+t,this.contentVisual.redraw(),this.refresh()}else this.contentVisual&&this.visual.remove(this.contentVisual),this.contentVisual=e,this.options.content="";return this.contentVisual?this.contentVisual.content():""},_hitTest:function(t){var e=this.bounds();return this.visible()&&e.contains(t)},_template:function(){var t=this;t.options.template&&t.model&&(t.options.content=l.template(t.options.template,{paramName:"item"})(t.model))}}),c=h.extend({init:function(t,e){var n,i,o,s=this;for(h.fn.init.call(s,t,e),t=s.options,s.connectors=[],s.type=t.type,s.shapeVisual=c.createShapeVisual(s.options),s.visual.append(this.shapeVisual),s.bounds(new x(t.x,t.y,Math.floor(t.width),Math.floor(t.height))),o=t.connectors.length,i=0;o>i;i++)n=new a(s,t.connectors[i]),s.connectors.push(n);s.parentContainer=null,s.isContainer=!1,s.isCollapsed=!1,s.id=s.visual.native.id,M.isDefined(t.content)&&s.content(t.content),s._rotate()},options:{type:"Shape",cssClass:"k-shape",data:"rectangle",stroke:"Black",strokeWidth:1,strokeThickness:1,strokeDashArray:"none",x:0,y:0,minWidth:20,minHeight:20,width:ue,height:de,background:"steelblue",hoveredBackground:"#70CAFF",connectors:f.DefaultConnectors,rotation:{angle:0},content:""},bounds:function(t){var e,n;return t&&(this._bounds=t,this.contentVisual&&this.contentVisual.redraw(this._bounds),e=t.topLeft(),this.options.x=e.x,this.options.y=e.y,this.options.width=t.width,this.options.height=t.height,this.visual.position(e),this.shapeVisual.redraw({width:t.width,height:t.height}),this.refreshConnections(),this.diagram&&this.diagram.trigger(q,{item:this,bounds:this._bounds.clone()})),this.contentVisual&&!this.contentVisual._measured&&this.contentVisual.redraw(this._bounds),this.options.width===ue&&this.options.height===de&&(n=this.shapeVisual._measure(),n&&this.bounds(new x(this.options.x,this.options.y,n.width,n.height))),this._bounds},position:function(t){return t?(this.bounds(new x(t.x,t.y,this._bounds.width,this._bounds.height)),e):this._bounds.topLeft()},clone:function(){var t,e=this.serialize();return e.options.id=l.diagram.randomId(),t=new c(e.options),t.diagram=this.diagram,t},visualBounds:function(){var t=this.bounds(),e=t.topLeft(),n=t.bottomRight();return x.fromPoints(this.diagram.transformPoint(e),this.diagram.transformPoint(n))},rotatedBounds:function(){var t=this.bounds().rotatedBounds(this.rotate().angle),e=t.topLeft(),n=t.bottomRight();return x.fromPoints(this.diagram.transformPoint(e),this.diagram.transformPoint(n))},select:function(t){this.isSelected!=t&&(this.isSelected=t,this.isSelected?this.diagram._selectedItems.push(this):this.diagram._selectedItems.remove(this),this.diagram._internalSelection||this.diagram.trigger(re,{items:[this]}))},rotate:function(t,n){var i,o,s,r,a=this.visual.rotate();return t!==e&&(s=this.bounds(),r=new I(s.width/2,s.height/2),n&&(i=t-a.angle,o=s.center().rotate(n,360-i).minus(r),this._rotationOffset=this._rotationOffset.plus(o.minus(s.topLeft())),this.position(o)),this.visual.rotate(t,r),this.options.rotation.angle=t,this.diagram&&this.diagram._connectorsAdorner&&this.diagram._connectorsAdorner.refresh(),this.refreshConnections(),this.diagram&&this.diagram.trigger(ae,{item:this})),a},connections:function(t){var e,n,i,o,s,r,a,h=[];for(e=0;e<this.connectors.length;e++)for(s=this.connectors[e],o=s.connections,n=0,o;n<o.length;n++)i=o[n],"out"==t?(r=i.source(),r.shape&&r.shape==this&&h.push(i)):"in"==t?(a=i.target(),a.shape&&a.shape==this&&h.push(i)):h.push(i);return h},_rotate:function(){var t=this.options.rotation;t&&t.angle&&this.rotate(t.angle),this._rotationOffset=new I},_hover:function(t){this.shapeVisual._hover(t),this.diagram._showConnectors(this,t)},refreshConnections:function(){t.each(this.connections(),function(){this.refresh()})},_hitTest:function(t){if(this.visible()){var e,n=this.bounds(),i=this.rotate().angle;if(t.isEmpty&&!t.isEmpty())return A.rects(t,n,i?360-i:0);if(e=t.clone().rotate(n.center(),360-i),n.contains(e))return this;if(this.adorner&&this.adorner._hitTest(t))return this}},getConnector:function(t){var e,n;if(!M.isString(t))return t instanceof I?i(t,this):this.connectors.length?this.connectors[0]:null;for(t=t.toLocaleLowerCase(),e=0;e<this.connectors.length;e++)if(n=this.connectors[e],n.options.name.toLocaleLowerCase()==t)return n},getPosition:function(t){var e=this.bounds(),n=t[0].toLowerCase()+t.slice(1);return M.isFunction(e[n])?this.transformPoint(e[n]()):e.center()},transformPoint:function(t){var e=this.rotate(),n=this.bounds(),i=n.topLeft(),o=t;return e.angle&&o.rotate(e.center().plus(i),360-e.angle),o},redraw:function(t){t&&(this.options=_({},this.options,t)),this.shapeVisual.redraw(t)}}),c.createShapeVisual=function(t){var e,n=_({},t,{x:0,y:0}),i=n.data;if(M.isString(i))switch(n.data.toLocaleLowerCase()){case"rectangle":return new b(n);case"circle":return new S(n);default:return e=new D(n)}else if(M.isFunction(i))return i(n.context);return new b(n)},u=h.extend({init:function(t,e,n,i){var o=this;h.fn.init.call(o,n,i),o._router=new Y(this),o.path=new D(o.options),o.path.background("none"),o.visual.append(o.path),o._sourcePoint=o._targetPoint=new I,o.source(t),o.target(e),o.content(o.options.content),o.definers=[],M.isDefined(n)&&n.points&&o.points(n.points),o.refresh()},options:{stroke:"gray",hoveredStroke:"#70CAFF",strokeThickness:1,startCap:"FilledCircle",endCap:"ArrowEnd",points:[],cssClass:"k-connection"},sourcePoint:function(){return this._resolvedSourceConnector?this._resolvedSourceConnector.position():this._sourcePoint},source:function(t,n){return M.isDefined(t)&&(n&&this.diagram?this.diagram.undoRedoService.addCompositeItem(new l.diagram.ConnectionEditUnit(this,t)):(t!==e&&(this.from=t),null===t?this.sourceConnector&&(this._sourcePoint=this._resolvedSourceConnector.position(),this._clearSourceConnector()):t instanceof a?(this.sourceConnector=t,this.sourceConnector.connections.push(this),this.refresh()):t instanceof I?(this._sourcePoint=t,this.sourceConnector&&this._clearSourceConnector(),this.refresh()):t instanceof c&&(this.sourceConnector=t.getConnector($),this.sourceConnector.connections.push(this),this.refresh()))),this.sourceConnector?this.sourceConnector:this._sourcePoint},sourceDefiner:function(t){if(!t)return this._sourceDefiner||(this._sourceDefiner=new f.PathDefiner(this.sourcePoint(),null,null)),this._sourceDefiner;if(!(t instanceof f.PathDefiner))throw"The sourceDefiner needs to be a PathDefiner.";t.left=null,this._sourceDefiner=t,this.source(t.point)},targetPoint:function(){return this._resolvedTargetConnector?this._resolvedTargetConnector.position():this._targetPoint},target:function(t,n){return M.isDefined(t)&&(n&&this.diagram?this.diagram.undoRedoService.addCompositeItem(new l.diagram.ConnectionEditUnit(this,t)):(t!==e&&(this.to=t),null===t?this.targetConnector&&(this._targetPoint=this._resolvedTargetConnector.position(),this._clearTargetConnector()):t instanceof a?(this.targetConnector=t,this.targetConnector.connections.push(this),this.refresh()):t instanceof I?(this._targetPoint=t,this.targetConnector&&this._clearTargetConnector(),this.refresh()):t instanceof c&&(this.targetConnector=t.getConnector($),this.targetConnector.connections.push(this),this.refresh()))),this.targetConnector?this.targetConnector:this._targetPoint},targetDefiner:function(t){if(!t)return this._targetDefiner||(this._targetDefiner=new f.PathDefiner(this.targetPoint(),null,null)),this._targetDefiner;if(!(t instanceof f.PathDefiner))throw"The sourceDefiner needs to be a PathDefiner.";t.right=null,this._targetDefiner=t,this.target(t.point)},select:function(t){this.isSelected!==t&&(this.isSelected=t,this.isSelected?(this.adorner=new U(this),this.diagram._adorn(this.adorner,!0),this.diagram._selectedItems.push(this)):this.adorner&&(this.diagram._adorn(this.adorner,!1),this.diagram._selectedItems.remove(this),this.adorner=e),this.refresh(),this.diagram._internalSelection||this.diagram.trigger(re,{items:[this]}))},bounds:function(t){return t?(this._bounds=t,e):this._bounds},type:function(t){if(!t)return this._type;if(t!==this._type){switch(this._type=t,t.toLowerCase()){case W.toLowerCase():this._router=new Z(this);break;case j.toLowerCase():this._router=new Y(this);break;default:throw"Unsupported connection type."}this.refresh()}},points:function(t){var e,n,i,o;if(!t){if(i=[],M.isDefined(this.definers))for(o=0;o<this.definers.length;o++)i.push(this.definers[o].point);return i}for(this.definers=[],e=0;e<t.length;e++)if(n=t[e],n instanceof f.Point)this.definers.push(new f.PathDefiner(n));else{if(!n.hasOwnProperty("x")||!n.hasOwnProperty("y"))throw"A Connection point needs to be a Point or an object with x and y properties.";this.definers.push(new f.PathDefiner(new I(n.x,n.y)))}},allPoints:function(){var t,e=[this.sourcePoint()];if(this.definers)for(t=0;t<this.definers.length;t++)e.push(this.definers[t].point);return e.push(this.targetPoint()),e},serialize:function(){var t=_({},{options:this.options,from:""+this.from,to:""+this.to});return this.model&&(t.model=""+this.model),t.options.points=this.points(),t},_hitTest:function(t){if(this.visible()){var e=new I(t.x,t.y),n=this.sourcePoint(),i=this.targetPoint();if(t.isEmpty&&!t.isEmpty()&&t.contains(n)&&t.contains(i))return this;if(this._router.hitTest(e))return this}},_hover:function(t){this.path.redraw({stroke:t?this.options.hoveredStroke:this.options.stroke})},_calcPathData:function(){function t(t){return t.x+" "+t.y}var e,n,i,o,s,r;for(this._router&&this._router.route(),e=this.sourcePoint(),n=this.targetPoint(),i="M"+t(e),o=this.points(),s=0;s<o.length;s++)r=o[s],i+=" L"+t(r);return i+" L"+t(n)},_refreshPath:function(){M.isUndefined(this.path)||(this._drawPath(this._calcPathData()),this.bounds(this._router.getBounds()))},_drawPath:function(t){this.path.redraw({data:t})},refresh:function(){n(this);var t,e,i,o,s=this.sourcePoint(),r=this.targetPoint();this._refreshPath(),t=this._bounds.topLeft(),e=s.minus(t),i=r.minus(t),this.contentVisual&&(o=I.fn.middleOf(e,i),this.contentVisual.position(new I(o.x+t.x,o.y+t.y))),this.adorner&&this.adorner.refresh()},redraw:function(t){this.options=_({},this.options,t),this.path.redraw(t)},clone:function(){var t=this.serialize(),e=new u(this.from,this.to,t.options);return e.diagram=this.diagram,e},_clearSourceConnector:function(){this.sourceConnector.connections.remove(this),this.sourceConnector=e,this._resolvedSourceConnector=e},_clearTargetConnector:function(){this.targetConnector.connections.remove(this),this.targetConnector=e,this._resolvedTargetConnector=e}}),d=m.extend({init:function(t,e){var n=this;m.fn.init.call(n,t,e),t=n.element,n.element.addClass("k-widget k-diagram").attr("role","diagram"),n.canvas=new y(t),this.mainLayer=new C({id:"main-layer"}),this.canvas.append(this.mainLayer),this.adornerLayer=new C({id:"adorner-layer"}),this.canvas.append(this.adornerLayer),n._initialize(),this.resizingAdorner=new z(this,{resizable:this.options.resizable,rotatable:this.options.rotatable}),this._adorn(this.resizingAdorner,!0),n.element.on("mousemove"+N,v(n._mouseMove,n)).on("mouseup"+N,v(n._mouseUp,n)).on("dblclick"+N,v(n._doubleClick,n)).on("mousedown"+N,v(n._mouseDown,n)).mousewheel(v(n._wheel,n),{ns:N}).on("keydown"+N,v(n._keydown,n)),n.selector=new B(n),n._clipboard=[],n._drop()},options:{name:"Diagram",zoomRate:1.1,dataSource:{},dragAndDrop:!1,template:"",dataTextField:null,autoBind:!0,resizable:!0,rotatable:!0,visualTemplate:null,tooltip:{enabled:!0,format:"{0}"},copy:{enabled:!0,offsetX:20,offsetY:20},allowDrop:!0},events:[ce,he,re,ae,q],destroy:function(){var t=this;m.fn.destroy.call(t),t.clear(),t.element.off(N),t.canvas.element.removeChild(t.canvas.native),t.canvas=e,t.destroyScroller(),t.options.dragAndDrop&&l.ui.DropTarget&&t.element.kendoDropTarget("destroy")},zoom:function(t,n){var i,o,s,r;return t&&(i=this._zoom,t=this._zoom=this.getValidZoom(t),n!==e&&(o=t/i,s=n.minus(this._pan),r=s.times(o),this._pan=n.minus(r)),this.transformMainLayer(),this.trigger(ce)),this._zoom},save:function(){var t,e,n,i={};for(i.options=this.options,i.shapes=[],i.connections=[],t=0;t<this.shapes.length;t++)e=this.shapes[t],i.shapes.push({options:e.options});for(t=0;t<this.connections.length;t++)n=this.connections[t],i.connections.push({options:n.options,from:""+n.from,to:""+n.to});return i},load:function(t){var e,n,i,o,r;for(this.options=t.options,this.clear(),this._initialize(),e=0;e<t.shapes.length;e++)n=t.shapes[e].options,n.undoable=!1,this.addShape(new c(n));for(e=0;e<t.connections.length;e++)i=t.connections[e],n=i.options,n.undoable=!1,o=s(this,i.from),r=s(this,i.to),this.addConnection(new u(o,r,n))},getValidZoom:function(t){return Math.min(Math.max(t,.55),2)},pan:function(t){return t instanceof I&&!t.equals(this._pan)&&(this._pan=t,this.transformMainLayer(),this.trigger(he)),this._pan},viewport:function(){return this.canvas.bounds()},transformMainLayer:function(){var t=this._pan,e=this._zoom,n=new P(t.x,t.y,e,e);n.render(this.mainLayer.native),this._matrix=n.toMatrix()},transformPoint:function(t){var e=t;return this._matrix&&(e=this._matrix.apply(t)),e},transformRect:function(t){var e,n,i=t;return this._matrix&&(e=this._matrix.apply(t.topLeft()),n=this._matrix.apply(t.bottomRight()),i=x.fromPoints(e,n)),i},focus:function(){var t=window.scrollX,e=window.scrollY;this.canvas.focus(),window.scrollTo(t,e)},clear:function(){var t=this;t.dataSource&&t._unbindDataSource(),t.mainLayer.clear(),this._initialize()},connect:function(t,e,n){var i=new u(t,e,n);return this.addConnection(i)},connected:function(t,e){var n,i;for(n=0;n<this.connections.length;n++)if(i=this.connections[n],i.from==t&&i.to==e)return!0;return!1},addConnection:function(t,n){if(n===e&&(n=!0),n){var i=new l.diagram.AddConnectionUnit(t,this);this.undoRedoService.add(i)}else t.diagram=this,this.mainLayer.append(t.visual),this.connections.push(t);return t},addShape:function(t,e){var n,i;return e=_({undoable:!0},e),M.isUndefined(t)&&(t=new I(0,0)),t instanceof c?n=t:(e=_(e,{x:t.x,y:t.y}),n=new c(e)),e.undoable?(i=new l.diagram.AddShapeUnit(n,this),this.undoRedoService.add(i)):(this.shapes.push(n),n.diagram=this,this.mainLayer.append(n.visual)),n},undo:function(){this.undoRedoService.undo()},redo:function(){this.undoRedoService.redo()},remove:function(t,e){if(e&&this.undoRedoService.begin(),t instanceof Array){t=t.slice(0);for(var n=0;n<t.length;n++)this._removeItem(t[n],e)}else(t instanceof c||t instanceof u)&&this._removeItem(t,e);e&&this.undoRedoService.commit()},select:function(t,n){var i,o,s,r,a,c=[];if(n=_({addToSelection:!1},n),a=n.addToSelection,t===e)return this._selectedItems;if(!a)for(;this._selectedItems.length>0;)this._selectedItems[0].select(!1);if(M.isBoolean(t))t!==!1&&this.select("All");else if("all"===(""+t).toLowerCase())for(s=this.shapes.concat(this.connections),this._internalSelection=!0,i=0;i<s.length;i++)o=s[i],o.select(!0),c.push(o);else if(t instanceof x)for(r=t,s=this.shapes.concat(this.connections),this._internalSelection=!0,i=0;i<s.length;i++)o=s[i],(!r||o._hitTest(r))&&(o.select(!0),c.push(o));else if(t instanceof Array)for(i=0;i<t.length;i++)o=s[i],o instanceof h&&(o.select(!0),c.push(o));else t instanceof h&&(t.select(!0),c.push(t));this.trigger(re,{items:c}),this._internalSelection=!1},toFront:function(t,e){var n,i,s=this._getDiagramItems(t);M.isUndefined(e)||e?(n=o(this.mainLayer.native,s.visuals),i=new G(this,t,n),this.undoRedoService.add(i)):(this.mainLayer.toFront(s.visuals),this._fixOrdering(s,!0))},toBack:function(t,e){var n,i,s=this._getDiagramItems(t);M.isUndefined(e)||e?(n=o(this.mainLayer.native,s.visuals),i=new K(this,t,n),this.undoRedoService.add(i)):(this.mainLayer.toBack(s.visuals),this._fixOrdering(s,!1))},_toIndex:function(t,e){var n=this._getDiagramItems(t);this.mainLayer.toIndex(n.visuals,e),this._fixOrdering(n,!1)},bringIntoView:function(t,e){var n,i,o,s,a,c,u=this.viewport();e=_({animate:!1,align:"center middle"},e),t instanceof h?n=t.visualBounds():M.isArray(t)?n=this.getBoundingBox(t):t instanceof x&&(n=t.clone()),"none"===e.align&&u.contains(n.center())||("none"===e.align&&(e.align="center middle"),o=n.clone(),i=new l.diagram.RectAlign(u),i.align(n,e.align),a=o.topLeft().minus(n.topLeft()),s=this.pan().minus(a),e.animate?(c=new H,c.addAdapter(new r({pan:s,diagram:this})),c.play()):this.pan(s))},getBoundingBox:function(t){var e,n,i=x.empty(),o=this._getDiagramItems(t);if(o.shapes.length>0)for(e=o.shapes[0],i=e.rotatedBounds(),n=1;n<o.shapes.length;n++)e=o.shapes[n],i=i.union(e.rotatedBounds());return i},getOriginBoundingBox:function(t){var e,n,i,o=x.empty(),s=this._getDiagramItems(t);if(s.shapes.length>0)for(n=s.shapes[0],o=n.bounds().clone(),o.x-=n._rotationOffset.x,o.y-=n._rotationOffset.y,i=1;i<s.shapes.length;i++)n=s.shapes[i],e=n.bounds().clone(),e.x-=n._rotationOffset.x,e.y-=n._rotationOffset.y,o=o.union(e);return o},_drop:function(){var t=this,e=t.options;e.allowDrop&&l.ui.DropTarget&&this.element.kendoDropTarget({drop:function(e){var n,i,o,s;e.draggable&&e.draggable.hint&&(n=e.draggable.hint.data("data"),i=e.draggable.hintOffset,o=t.documentToCanvasPoint(new I(i.left,i.top)),s=t._normalizePointZoom(o.minus(t.pan())),t.addShape(s,n))}})},_fixOrdering:function(t,e){var n,i,o=e?this.shapes.length-1:0,s=e?this.connections.length-1:0;for(n=0;n<t.shapes.length;n++)i=t.shapes[n],this.shapes.remove(i),this.shapes.insert(i,o);for(n=0;n<t.cons.length;n++)i=t.cons[n],this.connections.remove(i),this.connections.insert(i,s)},_getDiagramItems:function(t){var e,n,i={},o=t;for(i.visuals=[],i.shapes=[],i.cons=[],t?M.isArray(t)||(o=[t]):o=this._selectedItems,e=0;e<o.length;e++)n=o[e],n instanceof c?(i.shapes.push(n),i.visuals.push(n.visual)):n instanceof u&&(i.cons.push(n),i.visuals.push(n.visual));return i},_removeItem:function(t,e){t.select(!1),t instanceof c?this._removeShape(t,e):t instanceof u&&this._removeConnection(t,e),e||this.mainLayer.remove(t.visual)},_removeShape:function(t,e){var n,i,o,s,r=[],a=[];for(this.toolService._removeHover(),e?this.undoRedoService.addCompositeItem(new L(t)):this.shapes.remove(t),n=0;n<t.connectors.length;n++)for(o=t.connectors[n],s=0;s<o.connections.length;s++)i=o.connections[s],i.sourceConnector==o?r.push(i):i.targetConnector==o&&a.push(i);for(n=0;n<r.length;n++)r[n].source(null,e);for(n=0;n<a.length;n++)a[n].target(null,e)},_removeConnection:function(t,e){t.sourceConnector&&t.sourceConnector.connections.remove(t),t.targetConnector&&t.targetConnector.connections.remove(t),e?this.undoRedoService.addCompositeItem(new k(t)):this.connections.remove(t)},documentToCanvasPoint:function(t){var e=this.element.offset();return new I(t.x-e.left,t.y-e.top)},setDataSource:function(t){this.options.dataSource=t,this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},_mouseDown:function(t){var e=this._calculatePosition(t);0===t.button&&this.toolService.start(e,this._meta(t))&&t.preventDefault()},copy:function(){var t,e;if(this.options.copy.enabled)for(this._clipboard.clear(),this._copyOffset=1,t=0;t<this._selectedItems.length;t++)e=this._selectedItems[t],this._clipboard.push(e)},cut:function(){var t,e;if(this.options.copy.enabled){for(this._clipboard.clear(),this._copyOffset=0,t=0;t<this._selectedItems.length;t++)e=this._selectedItems[t],this._clipboard.push(e);this.remove(this._clipboard)}},paste:function(){var t,e,n,i,o,s,r,h;if(this._clipboard.length>0){for(h=new X,t=this._copyOffset*this.options.copy.offsetX,e=this._copyOffset*this.options.copy.offsetY,this.select(!1),r=0;r<this._clipboard.length;r++)n=this._clipboard[r],n instanceof u||(i=n.clone(),h.set(n.id,i.id),this._addItem(i),i.position(new I(n.options.x+t,n.options.y+e)),i.select(!0));for(r=0;r<this._clipboard.length;r++)n=this._clipboard[r],n instanceof c||(i=n.clone(),n.source()instanceof a&&(o=n.source(),h.containsKey(o.shape.id)?(s=this.getId(h.get(o.shape.id)),i.source(s.getConnector(o.options.name))):i.source(new I(n.sourcePoint().x+t,n.sourcePoint().y+e))),n.target()instanceof a&&(o=n.target(),h.containsKey(o.shape.id)?(s=this.getId(h.get(o.shape.id)),i.target(s.getConnector(o.options.name))):i.target(new I(n.targetPoint().x+t,n.targetPoint().y+e))),this._addItem(i),i.position(new I(n.options.x+t,n.options.y+e)),i.select(!0));this._copyOffset+=1}},_addItem:function(t){t instanceof c?this.addShape(t):t instanceof u&&this.addConnection(t)},_mouseUp:function(t){var e=this._calculatePosition(t);0===t.button&&this.toolService.end(e,this._meta(t))&&t.preventDefault()},_mouseMove:function(t){var e=this._calculatePosition(t);0===t.button&&this.toolService.move(e,this._meta(t))&&t.preventDefault()},_doubleClick:function(t){var e=this._calculatePosition(t);0===t.button&&this.toolService.doubleClick(e,this._meta(t))&&t.preventDefault()},_keydown:function(t){this.toolService.keyDown(t.keyCode,this._meta(t))&&t.preventDefault()},_wheel:function(t){var e=this._calculatePosition(t),n=_(this._meta(t),{delta:t.data.delta});this.toolService.wheel(e,n)&&t.preventDefault()},_meta:function(t){return{ctrlKey:t.ctrlKey,metaKey:t.metaKey,altKey:t.altKey}},_calculatePosition:function(t){var n=t.pageX===e?t.originalEvent:t,i=new I(n.pageX,n.pageY),o=this.documentToCanvasPoint(i);return this._normalizePointZoom(o.minus(this.pan()))},_normalizePointZoom:function(t){return t.times(1/this.zoom())},_initialize:function(){this._zoom=1,this._pan=new I,this.shapes=[],this._selectedItems=[],this.connections=[],this._adorners=[],this.dataMap=[],this.undoRedoService=new V,this.toolService=new R(this),this.id=l.diagram.randomId(),this._accessors(),this._dataSource(),this.options.autoBind&&this.dataSource.fetch()},_dataSource:function(){var t=this,e=t.options,n=e.dataSource;n=M.isArray(n)?{data:n}:n,n.fields||(n.fields=[{field:"text"},{field:"url"},{field:"spriteCssClass"},{field:"imageUrl"}]),t.dataSource&&t._refreshHandler?t._unbindDataSource():(t._refreshHandler=v(t.refreshSource,t),t._errorHandler=v(t._error,t)),t.dataSource=w.create(n).bind(Q,t._refreshHandler).bind(J,t._errorHandler)},_unbindDataSource:function(){var t=this;t.dataSource.unbind(Q,t._refreshHandler).unbind(J,t._errorHandler)},_error:function(){},_accessors:function(){var t,e,n,i=this,o=i.options,s=i.element;for(t in oe)oe.hasOwnProperty(t)&&(e=o[oe[t]],n=s.attr(l.attr(t+"-field")),!e&&n&&(e=n),e||(e=t),M.isArray(e)||(e=[e]),o[oe[t]]=e)},_adorn:function(t,n){n!==e&&t&&(n?(this._adorners.push(t),this.adornerLayer.append(t.visual)):(this._adorners.remove(t),this.adornerLayer.remove(t.visual)))},_showConnectors:function(t,e){e&&(this._connectorsAdorner=new O(t)),this._adorn(this._connectorsAdorner,e)},refresh:function(){var t;for(t=0;t<this.connections.length;t++)this.connections[t].refresh()},findByUid:function(t){return this.element.find(".k-shape["+l.attr("uid")+"="+t+"]")},refreshSource:function(t){function e(t){var e,n=o.dataMap.first(function(e){return e.uid===t.uid});return n?n.shape:(e={data:h.visualTemplate,template:h.template,context:t},n=new c(e,t),o.addShape(n),o.dataMap.push({uid:t.uid,shape:n}),n)}function n(t,n){var i,s,r,a,h;for(i=0;i<n.length;i++)s=n[i],r=e(s),a=e(t),a&&!o.connected(a,r)&&(h=o.connect(a,r),h.type(W))}var i,o=this,s=t.node,r=t.action,a=t.items,h=o.options;if(!t.field){if("add"===r)n(s,a);else if("remove"===r);else if("itemchange"===r)if(s)a.length&&n(s,a);else for(i=0;i<a.length;i++)e(a[i]);for(i=0;i<a.length;i++)a[i].load()}},layout:function(t,e){var n,i,o,s;switch(this.isLayouting=!0,M.isUndefined(t)&&(t=f.LayoutTypes.TreeLayout),t){case f.LayoutTypes.TreeLayout:n=new f.TreeLayout(this);break;case f.LayoutTypes.LayeredLayout:n=new f.LayeredLayout(this);break;case f.LayoutTypes.ForceDirectedLayout:n=new f.SpringLayout(this);break;default:throw"Layout algorithm '"+t+"' is not supported."}i=new l.diagram.LayoutState(this),o=n.layout(e),o&&(s=new l.diagram.LayoutUndoUnit(i,o,e?e.animate:null),this.undoRedoService.add(s)),this.isLayouting=!1},alignShapes:function(t){var e,n,i,o,s,r,a;if(M.isUndefined(t)&&(t="Left"),o=this.select(),0!==o.length){switch(t.toLowerCase()){case"left":case"top":e=Number.MAX_VALUE;break;case"right":case"bottom":e=Number.MIN_VALUE}for(i=0;i<o.length;i++)if(n=o[i],n instanceof c)switch(t.toLowerCase()){case"left":e=Math.min(e,n.options.x);break;case"top":e=Math.min(e,n.options.y);break;case"right":e=Math.max(e,n.options.x);break;case"bottom":e=Math.max(e,n.options.y)}for(s=[],r=[],i=0;i<o.length;i++)if(n=o[i],n instanceof c)switch(r.push(n),s.push(n.bounds()),t.toLowerCase()){case"left":case"right":n.position(new I(e,n.options.y));break;case"top":case"bottom":n.position(new I(n.options.x,e))}a=new l.diagram.TransformUnit(r,s),this.undoRedoService.add(a,!1)}},randomDiagram:function(t,e,n,i){var o=l.diagram.Graph.Utils.createRandomConnectedGraph(t,e,n);l.diagram.Graph.Utils.createDiagramFromGraph(this,o,!1,i)},getId:function(t){var e;return(e=this.shapes.first(function(e){return e.visual.native.id===t}))?e:e=this.connections.first(function(e){return e.visual.native.id===t})}}),p.plugin(d),l.deepExtend(f,{Shape:c,Connection:u,Connector:a})}(window.kendo.jQuery)})}("function"==typeof define&&define.amd?define:function(t,e){return e()});/*
//@ sourceMappingURL=kendo.diagram.dom.min.js.map
*/
/*
* Kendo UI Complete v2013.3.1316 (http://kendoui.com)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI Complete commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-complete-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(define){return define(["./kendo.dataviz.core.min","./kendo.diagram.utils.min"],function(){!function(t,n){function i(t){return Math.abs(t)<M}function e(t,n,e,s,h){var r,o,a,d,u=(n.x-t.x)*(s.y-e.y)-(n.y-t.y)*(s.x-e.x);if(!i(u)&&(r=(t.y-e.y)*(s.x-e.x)-(t.x-e.x)*(s.y-e.y),o=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y),a=r/u,d=o/u,!h||!(0>a||a>1||0>d||d>1)))return new C(t.x+a*(n.x-t.x),t.y+a*(n.y-t.y))}function s(t,n){var i,e,s;do i=2*Math.random()-1,e=2*Math.random()-1,s=i*i+e*e;while(!s||s>1);return t+n*i*Math.sqrt(-2*Math.log(s)/s)}function h(t){var n,i,e;for(U.isUndefined(t)&&(t=10),n="",i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=t;e>0;--e)n+=i[Math.round(Math.random()*(i.length-1))];return n}var r,o,a,d,u,c,f,l,g,y,m,p,w,v,x,k,b=window.kendo,_=b.diagram,N=b.Class,L=b.deepExtend,T=b.dataviz,U=_.Utils,C=T.Point2D,E=3,M=1e-6;L(C.fn,{plus:function(t){return new C(this.x+t.x,this.y+t.y)},minus:function(t){return new C(this.x-t.x,this.y-t.y)},offset:function(t){return new C(this.x-t,this.y-t)},times:function(t){return new C(this.x*t,this.y*t)},normalize:function(){return 0===this.length()?new C:this.times(1/this.length())},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},toString:function(){return"("+this.x+","+this.y+")"},lengthSquared:function(){return this.x*this.x+this.y*this.y},middleOf:function(t,n){return new C(n.x-t.x,n.y-t.y).times(.5).plus(t)},toPolar:function(t){var n,i,e,s=1;if(t&&(s=180/Math.PI),n=Math.atan2(Math.abs(this.y),Math.abs(this.x)),i=Math.PI/2,e=this.length(),0===this.x){if(0===this.y)return new c(0,0);if(this.y>0)return new c(e,s*i);if(this.y<0)return new c(e,3*s*i)}else if(this.x>0){if(0===this.y)return new c(e,0);if(this.y>0)return new c(e,s*n);if(this.y<0)return new c(e,s*(4*i-n))}else{if(0===this.y)return new c(e,2*i);if(this.y>0)return new c(e,s*(2*i-n));if(this.y<0)return new c(e,s*(2*i+n))}},isOnLine:function(t,n){var i,e,s,h,r;return t.x>n.x&&(i=n,n=t,t=i),h=new o(t.x,t.y).inflate(E,E),r=new o(n.x,n.y).inflate(E,E),h.union(r).contains(this)?t.x===n.x||t.y===n.y?!0:(t.y<n.y?(e=h.x+(r.x-h.x)*(this.y-(h.y+h.height))/(r.y+r.height-(h.y+h.height)),s=h.x+h.width+(r.x+r.width-(h.x+h.width))*(this.y-h.y)/(r.y-h.y)):(e=h.x+(r.x-h.x)*(this.y-h.y)/(r.y-h.y),s=h.x+h.width+(r.x+r.width-(h.x+h.width))*(this.y-(h.y+h.height))/(r.y+r.height-(h.y+h.height))),this.x>e&&this.x<s):!1}}),L(C,{parse:function(t){var i=t.slice(1,t.length-1),e=i.split(","),s=parseInt(e[0],10),h=parseInt(e[1],10);return isNaN(s)||isNaN(h)?n:new C(s,h)}}),r=N.extend({init:function(t,n,i){this.point=t,this.left=n,this.right=i}}),o=N.extend({init:function(t,n,i,e){this.x=t||0,this.y=n||0,this.width=i||0,this.height=e||0},contains:function(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height},inflate:function(t,i){return i===n&&(i=t),this.x-=t,this.y-=i,this.width+=2*t+1,this.height+=2*i+1,this},offset:function(t,n){var i=t,e=n;return t instanceof C&&(i=t.x,e=t.y),this.x+=i,this.y+=e,this},union:function(t){var n=Math.min(this.x,t.x),i=Math.min(this.y,t.y),e=Math.max(this.x+this.width,t.x+t.width),s=Math.max(this.y+this.height,t.y+t.height);return new o(n,i,e-n,s-i)},center:function(){return new C(this.x+this.width/2,this.y+this.height/2)},top:function(){return new C(this.x+this.width/2,this.y)},right:function(){return new C(this.x+this.width,this.y+this.height/2)},bottom:function(){return new C(this.x+this.width/2,this.y+this.height)},left:function(){return new C(this.x,this.y+this.height/2)},topLeft:function(){return new C(this.x,this.y)},topRight:function(){return new C(this.x+this.width,this.y)},bottomLeft:function(){return new C(this.x,this.y+this.height)},bottomRight:function(){return new C(this.x+this.width,this.y+this.height)},clone:function(){return new o(this.x,this.y,this.width,this.height)},isEmpty:function(){return!this.width&&!this.height},equals:function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},rotatedBounds:function(t){var n=this.clone(),i=n.center(),e=n.bottomRight().rotate(i,360-t),s=n.topLeft().rotate(i,360-t),h=n.topRight().rotate(i,360-t),r=n.bottomLeft().rotate(i,360-t);return n.x=Math.min(e.x,s.x,h.x,r.x),n.y=Math.min(e.y,s.y,h.y,r.y),n.width=Math.max(e.x,s.x,h.x,r.x)-n.x,n.height=Math.max(e.y,s.y,h.y,r.y)-n.y,n},toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height}}),a=N.extend({init:function(t,n){this.width=t,this.height=n}}),a.prototype.Empty=new a(0,0),o.toRect=function(t){return t instanceof o||(t=new o(t.x,t.y,t.width,t.height)),t},o.empty=function(){return new o(0,0,0,0)},o.fromPoints=function(t,n){if(isNaN(t.x)||isNaN(t.y)||isNaN(n.x)||isNaN(n.y))throw"Some values are NaN.";return new o(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.abs(t.x-n.x),Math.abs(t.y-n.y))},d={lines:function(t,n,i,s){return e(t,n,i,s)},segments:function(t,n,i,s){return e(t,n,i,s,!0)},rectWithLine:function(t,n,i){return d.segments(n,i,t.topLeft(),t.topRight())||d.segments(n,i,t.topRight(),t.bottomRight())||d.segments(n,i,t.bottomLeft(),t.bottomRight())||d.segments(n,i,t.topLeft(),t.bottomLeft())},rects:function(t,n,i){var e,s,h=n.topLeft(),r=n.topRight(),o=n.bottomLeft(),a=n.bottomRight(),u=n.center();return i&&(h=h.rotate(u,i),r=r.rotate(u,i),o=o.rotate(u,i),a=a.rotate(u,i)),e=t.contains(h)||t.contains(r)||t.contains(o)||t.contains(a)||d.rectWithLine(t,h,r)||d.rectWithLine(t,h,o)||d.rectWithLine(t,r,a)||d.rectWithLine(t,o,a),e||(h=t.topLeft(),r=t.topRight(),o=t.bottomLeft(),a=t.bottomRight(),i&&(s=360-i,h=h.rotate(u,s),r=r.rotate(u,s),o=o.rotate(u,s),a=a.rotate(u,s)),e=n.contains(h)||n.contains(r)||n.contains(o)||n.contains(a)),e}},u=N.extend({init:function(t){this.container=o.toRect(t)},align:function(t,n){var i,e=n.toLowerCase().split(" ");for(i=0;i<e.length;i++)t=this._singleAlign(t,e[i]);return t},_singleAlign:function(t,n){return U.isFunction(this[n])?this[n](t):t},left:function(t){return this._hAlign(t,this._left)},center:function(t){return this._hAlign(t,this._center)},right:function(t){return this._hAlign(t,this._right)},top:function(t){return this._vAlign(t,this._top)},middle:function(t){return this._vAlign(t,this._middle)},bottom:function(t){return this._vAlign(t,this._bottom)},_left:function(t){return t.x},_center:function(t,n){return(t.width-n.width)/2||0},_right:function(t,n){return t.width-n.width},_top:function(t){return t.y},_middle:function(t,n){return(t.height-n.height)/2||0},_bottom:function(t,n){return t.height-n.height},_hAlign:function(t,n){return t=o.toRect(t),t.x=n(this.container,t),t},_vAlign:function(t,n){return t=o.toRect(t),t.y=n(this.container,t),t}}),c=N.extend({init:function(t,n){this.r=t,this.angle=n}}),f=N.extend({init:function(t,n,i,e,s,h){this.a=t||0,this.b=n||0,this.c=i||0,this.d=e||0,this.e=s||0,this.f=h||0},plus:function(t){this.a+=t.a,this.b+=t.b,this.c+=t.c,this.d+=t.d,this.e+=t.e,this.f+=t.f},minus:function(t){this.a-=t.a,this.b-=t.b,this.c-=t.c,this.d-=t.d,this.e-=t.e,this.f-=t.f},times:function(t){return new f(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)},apply:function(t){return new C(this.a*t.x+this.c*t.y+this.e,this.b*t.x+this.d*t.y+this.f)},toString:function(){return"matrix("+this.a+" "+this.b+" "+this.c+" "+this.d+" "+this.e+" "+this.f+")"}}),L(f,{fromSVGMatrix:function(t){var n=new f;return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n.e=t.e,n.f=t.f,n},fromMatrixVector:function(t){var n=new f;return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n.e=t.e,n.f=t.f,n},fromList:function(t){if(6!==t.length)throw"The given list should consist of six elements.";var n=new f;return n.a=t[0],n.b=t[1],n.c=t[2],n.d=t[3],n.e=t[4],n.f=t[5],n},translation:function(t,n){var i=new f;return i.a=1,i.b=0,i.c=0,i.d=1,i.e=t,i.f=n,i},unit:function(){return new f(1,0,0,1,0,0)},rotation:function(t,n,i){var e=new f;return e.a=Math.cos(t*Math.PI/180),e.b=Math.sin(t*Math.PI/180),e.c=-e.b,e.d=e.a,e.e=n-n*e.a+i*e.b||0,e.f=i-i*e.a-n*e.b||0,e},scaling:function(t,n){var i=new f;return i.a=t,i.b=0,i.c=0,i.d=n,i.e=0,i.f=0,i},parse:function(t){var n,i;if(t){if(t=t.trim(),"matrix"===t.slice(0,6).toLowerCase()){if(i=t.slice(7,t.length-1).trim(),n=i.split(","),6===n.length)return f.fromList(n.map(function(t){return parseFloat(t)}));if(n=i.split(" "),6===n.length)return f.fromList(n.map(function(t){return parseFloat(t)}))}if("("===t.slice(0,1)&&")"===t.slice(t.length-1)&&(t=t.substr(1,t.length-1)),t.indexOf(",")>0&&(n=t.split(","),6===n.length))return f.fromList(n.map(function(t){return parseFloat(t)}));if(t.indexOf(" ")>0&&(n=t.split(" "),6===n.length))return f.fromList(n.map(function(t){return parseFloat(t)}))}return n}}),l=N.extend({init:function(t,n,i,e,s,h){this.a=t||0,this.b=n||0,this.c=i||0,this.d=e||0,this.e=s||0,this.f=h||0},fromMatrix:function(t){var n=new l;return n.a=t.a,n.b=t.b,n.c=t.c,n.d=t.d,n.e=t.e,n.f=t.f,n}}),g={_distanceToLineSquared:function(t,n,i){function e(t,n){return(t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y)}if(n===i)return e(t,n);var s=i.x-n.x,h=i.y-n.y,r=(t.x-n.x)*s+(t.y-n.y)*h;return 0>r?e(n,t):(r=(i.x-t.x)*s+(i.y-t.y)*h,0>r?e(i,t):(r=(i.x-t.x)*h-(i.y-t.y)*s,r*r/(s*s+h*h)))},distanceToLine:function(t,n,i){return Math.sqrt(this._distanceToLineSquared(t,n,i))},distanceToPolyline:function(t,n){var i,e,s,h,r=Number.MAX_VALUE;if(U.isUndefined(n)||0===n.length)return Number.MAX_VALUE;for(i=0;i<n.length-1;i++)e=n[i],s=n[i+1],h=this._distanceToLineSquared(t,e,s),r>h&&(r=h);return Math.sqrt(r)}},y=b.Class.extend({init:function(){this._buckets=[],this.length=0},add:function(t,n){var i=this._createGetBucket(t);return U.isDefined(n)&&(i.value=n),i},get:function(t){return this._bucketExists(t)?this._createGetBucket(t):null},set:function(t,n){this.add(t,n)},containsKey:function(t){return this._bucketExists(t)},remove:function(t){if(this._bucketExists(t)){var n=this._hash(t);return delete this._buckets[n],this.length--,t}},forEach:function(t){var n,i,e,s,h=this._hashes();for(n=0,i=h.length;i>n;n++)e=h[n],s=this._buckets[e],U.isUndefined(s)||t(s)},clone:function(){var t,n,i,e,s=new y,h=this._hashes();for(t=0,n=h.length;n>t;t++)i=h[t],e=this._buckets[i],U.isUndefined(e)||s.add(e.key,e.value);return s},_hashes:function(){var t,n=[];for(t in this._buckets)this._buckets.hasOwnProperty(t)&&n.push(t);return n},_bucketExists:function(t){var n=this._hash(t);return U.isDefined(this._buckets[n])},_createGetBucket:function(t){var n=this._hash(t),i=this._buckets[n];return U.isUndefined(i)&&(i={key:t},this._buckets[n]=i,this.length++),i},_hash:function(t){if(U.isNumber(t))return t;if(U.isString(t))return this._hashString(t);if(U.isObject(t))return this._objectHashId(t);throw"Unsupported key type."},_hashString:function(t){var n,i,e=0;if(0===t.length)return e;for(n=0;n<t.length;n++)i=t.charCodeAt(n),e=32*e-e+i;return e},_objectHashId:function(t){var n=t._hashId;return U.isUndefined(n)&&(n=h(),t._hashId=n),n}}),m=b.Observable.extend({init:function(t){var n=this;b.Observable.fn.init.call(n),this._hashTable=new y,this.length=0,U.isDefined(t)&&t.forEach(function(t,n){this.add(t,n)},this)},add:function(t,n){var i=this._hashTable.get(t);i||(i=this._hashTable.add(t),this.length++,this.trigger("changed")),i.value=n},set:function(t,n){this.add(t,n)},get:function(t){var n=this._hashTable.get(t);if(n)return n.value;throw Error("Cannot find key "+t)},containsKey:function(t){return this._hashTable.containsKey(t)},remove:function(t){return this.containsKey(t)?(this.trigger("changed"),this.length--,this._hashTable.remove(t)):n},forEach:function(t,n){this._hashTable.forEach(function(i){t.call(n,i.key,i.value)})},forEachValue:function(t,n){this._hashTable.forEach(function(i){t.call(n,i.value)})},forEachKey:function(t,n){this._hashTable.forEach(function(i){t.call(n,i.key)})},keys:function(){var t=[];return this.forEachKey(function(n){t.push(n)}),t}}),p=b.Class.extend({init:function(){this._tail=null,this._head=null,this.length=0},enqueue:function(t){var n={value:t,next:null};this._head?(this._tail.next=n,this._tail=this._tail.next):(this._head=n,this._tail=this._head),this.length++},dequeue:function(){if(this.length<1)throw Error("The queue is empty.");var t=this._head.value;return this._head=this._head.next,this.length--,t},contains:function(t){for(var n=this._head;n;){if(n.value===t)return!0;n=n.next}return!1}}),w=b.Observable.extend({init:function(t){var n=this;b.Observable.fn.init.call(n),this._hashTable=new y,this.length=0,U.isDefined(t)&&(t instanceof y?t.forEach(function(t){this.add(t)}):t instanceof m&&t.forEach(function(t,n){this.add({key:t,value:n})},this))},contains:function(t){return this._hashTable.containsKey(t)},add:function(t){var n=this._hashTable.get(t);n||(this._hashTable.add(t,t),this.length++,this.trigger("changed"))},get:function(t){return this.contains(t)?this._hashTable.get(t).value:null},hash:function(t){return this._hashTable._hash(t)},remove:function(t){this.contains(t)&&(this._hashTable.remove(t),this.length--,this.trigger("changed"))},forEach:function(t,n){this._hashTable.forEach(function(n){t(n.value)},n)},toArray:function(){var t=[];return this.forEach(function(n){t.push(n)}),t}}),v=b.Class.extend({init:function(t,n){if(this.links=[],this.outgoing=[],this.incoming=[],this.weight=1,this.id=U.isDefined(t)?t:h(),U.isDefined(n)){this.associatedShape=n;var i=n.bounds();this.width=i.width,this.height=i.height,this.x=i.x,this.y=i.y}else this.associatedShape=null;this.data=null,this.type="Node",this.shortForm="Node '"+this.id+"'",this.isVirtual=!1},isIsolated:function(){return this.links.isEmpty()},bounds:function(t){return U.isDefined(t)?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,n):new _.Rect(this.x,this.y,this.width,this.height)},isLinkedTo:function(t){var n=this;return this.links.any(function(i){return i.getComplement(n)===t})},getChildren:function(){var t,n,i,e;if(0===this.outgoing.length)return[];for(t=[],n=0,i=this.outgoing.length;i>n;n++)e=this.outgoing[n],t.add(e.getComplement(this));return t},getParents:function(){var t,n,i,e;if(0===this.incoming.length)return[];for(t=[],n=0,i=this.incoming.length;i>n;n++)e=this.incoming[n],t.add(e.getComplement(this));return t},clone:function(){var t=new v;return U.isDefined(this.weight)&&(t.weight=this.weight),U.isDefined(this.balance)&&(t.balance=this.balance),U.isDefined(this.owner)&&(t.owner=this.owner),t.associatedShape=this.associatedShape,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},adjacentTo:function(t){return null!==this.isLinkedTo(t)},removeLink:function(t){t.source===this&&(this.links.remove(t),this.outgoing.remove(t),t.source=null),t.target===this&&(this.links.remove(t),this.incoming.remove(t),t.target=null)},hasLinkTo:function(t){return this.outgoing.any(function(n){return n.target===t})},degree:function(){return this.links.length},incidentWith:function(t){return this.links.contains(t)},getLinksWith:function(t){return this.links.all(function(n){return n.getComplement(this)===t},this)},getNeighbors:function(){var t=[];return this.incoming.forEach(function(n){t.push(n.getComplement(this))},this),this.outgoing.forEach(function(n){t.push(n.getComplement(this))},this),t}}),x=b.Class.extend({init:function(t,n,i,e){if(U.isUndefined(t))throw"The source of the new link is not set.";if(U.isUndefined(n))throw"The target of the new link is not set.";var s,r;s=U.isString(t)?new v(t):t,r=U.isString(n)?new v(n):n,this.source=s,this.target=r,this.source.links.add(this),this.target.links.add(this),this.source.outgoing.add(this),this.target.incoming.add(this),this.id=U.isDefined(i)?i:h(),this.associatedConnection=U.isDefined(e)?e:null,this.type="Link",this.shortForm="Link '"+this.source.id+"->"+this.target.id+"'"},getComplement:function(t){if(this.source!==t&&this.target!==t)throw"The given node is not incident with this link.";return this.source===t?this.target:this.source},getCommonNode:function(t){return this.source===t.source||this.source===t.target?this.source:this.target===t.source||this.target===t.target?this.target:null},isBridging:function(t,n){return this.source===t&&this.target===n||this.source===n&&this.target===t},getNodes:function(){return[this.source,this.target]},incidentWith:function(t){return this.source===t||this.target===t},adjacentTo:function(t){return this.source.links.contains(t)||this.target.links.contains(t)},changeSource:function(t){this.source.links.remove(this),this.source.outgoing.remove(this),t.links.push(this),t.outgoing.push(this),this.source=t},changeTarget:function(t){this.target.links.remove(this),this.target.incoming.remove(this),t.links.push(this),t.incoming.push(this),this.target=t},changesNodes:function(t,n){this.source===t?this.changeSource(n):this.target===t&&this.changeTarget(n)},reverse:function(){var t=this.source,n=this.target;return this.source=n,t.outgoing.remove(this),this.source.outgoing.push(this),this.target=t,n.incoming.remove(this),this.target.incoming.push(this),this},directTo:function(t){if(this.source!==t&&this.target!==t)throw"The given node is not incident with this link.";this.target!==t&&this.reverse()},createReverseEdge:function(){var t=this.clone();return t.reverse(),t.reversed=!0,t},clone:function(){var t=new x(this.source,this.target);return t}}),k=b.Class.extend({init:function(t){this.links=[],this.nodes=[],this.diagram=null,this._root=null,U.isDefined(t)?U.isString(t)?this.id=t:(this.diagram=t,this.id=t.id):this.id=h(),this.bounds=new o,this._hasCachedRelationships=!1,this.type="Graph"},cacheRelationships:function(t){var n,i,e;if(U.isUndefined(t)&&(t=!1),!this._hasCachedRelationships||t){for(n=0,i=this.nodes.length;i>n;n++)e=this.nodes[n],e.children=this.getChildren(e),e.parents=this.getParents(e);this._hasCachedRelationships=!0}},assignLevels:function(t,n,i){var e,s,h,r;if(!t)throw"Start node not specified.";for(U.isUndefined(n)&&(n=0),this.cacheRelationships(),U.isUndefined(i)&&(i=new m,this.nodes.forEach(function(t){i.add(t,!1)})),i.set(t,!0),t.level=n,e=t.children,s=0,h=e.length;h>s;s++)r=e[s],r&&!i.get(r)&&this.assignLevels(r,n+1,i)},root:function(t){if(U.isUndefined(t)){if(this._root)return this._root;var n=this.nodes.first(function(t){return 0===t.incoming.length});return n?n:this.nodes.first()}this._root=t},getConnectedComponents:function(){var t,n,i,e,s;for(this.componentIndex=0,this.setItemIndices(),t=U.initArray(this.nodes.length,-1),n=0;n<this.nodes.length;n++)-1===t[n]&&(this._collectConnectedNodes(t,n),this.componentIndex++);for(e=[],i=0;i<this.componentIndex;++i)e[i]=new k;for(i=0;i<t.length;++i)s=e[t[i]],s.addNodeAndOutgoings(this.nodes[i]);return e.sort(function(t,n){return n.nodes.length-t.nodes.length}),e},_collectConnectedNodes:function(t,n){t[n]=this.componentIndex;var i=this.nodes[n];i.links.forEach(function(n){var e=n.getComplement(i),s=e.index;-1===t[s]&&this._collectConnectedNodes(t,s)},this)},calcBounds:function(){var t,n,i,e;if(this.isEmpty())return this.bounds=new o,this.bounds;for(t=null,n=0,i=this.nodes.length;i>n;n++)e=this.nodes[n],t=t?t.union(e.bounds()):e.bounds();return this.bounds=t,this.bounds},getSpanningTree:function(t){var n,i,e,s,h,r,o,a,d,u,c,f,l=new k,g=new m;for(l.root=t.clone(),l.root.level=0,l.root.id=t.id,g.add(t,l.root),t.level=0,e=[],s=[],l.nodes.add(l.root),e.add(t),s.add(t),h=1;s.length>0;)for(r=s.pop(),o=0;o<r.links.length;o++)a=r.links[o],d=a.getComplement(r),e.contains(d)||(d.level=r.level+1,h<d.level+1&&(h=d.level+1),s.contains(d)||s.add(d),e.contains(d)||e.add(d),g.containsKey(r)?n=g.get(r):(n=r.clone(),n.level=r.level,n.id=r.id,g.add(r,n)),g.containsKey(d)?i=g.get(d):(i=d.clone(),i.level=d.level,i.id=d.id,g.add(d,i)),u=new x(n,i),l.addLink(u));for(c=[],f=0;h>f;f++)c.add([]);return l.nodes.forEach(function(t){c[t.level].add(t)}),l.treeLevels=c,l.cacheRelationships(),l},takeRandomNode:function(t,n){if(U.isUndefined(t)&&(t=[]),U.isUndefined(n)&&(n=4),0===this.nodes.length)return null;if(1===this.nodes.length)return t.contains(this.nodes[0])?null:this.nodes[0];var i=this.nodes.where(function(i){return!t.contains(i)&&i.degree()<=n});return i.isEmpty()?null:i[U.randomInteger(0,i.length)]},isEmpty:function(){return this.nodes.isEmpty()},isHealthy:function(){return this.links.all(function(t){return this.nodes.contains(t.source)&&this.nodes.contains(t.target)},this)},getParents:function(t){if(!this.hasNode(t))throw"The given node is not part of this graph.";return t.getParents()},getChildren:function(t){if(!this.hasNode(t))throw"The given node is not part of this graph.";return t.getChildren()},addLink:function(t,i,e){var s,h,r;if(U.isUndefined(t))throw"The source of the link is not defined.";if(U.isUndefined(i)){if(U.isDefined(t.type)&&"Link"===t.type)return this.addExistingLink(t),n;throw"The target of the link is not defined."}return s=this.getNode(t),U.isUndefined(s)&&(s=this.addNode(t)),h=this.getNode(i),U.isUndefined(h)&&(h=this.addNode(i)),r=new x(s,h),U.isDefined(e)&&(r.owner=e),this.links.push(r),r},removeAllLinks:function(){for(;this.links.length>0;){var t=this.links[0];this.removeLink(t)}},addExistingLink:function(t){var n,i;this.hasLink(t)||(this.links.push(t),this.hasNode(t.source.id)?(n=this.getNode(t.source.id),t.changeSource(n)):this.addNode(t.source),this.hasNode(t.target.id)?(i=this.getNode(t.target.id),t.changeTarget(i)):this.addNode(t.target))},hasLink:function(t){if(U.isString(t))return this.links.any(function(n){return n.id===t});if("Link"===t.type)return this.links.contains(t);throw"The given object is neither an identifier nor a Link."},getNode:function(t){if(U.isUndefined(t))throw"No identifier or Node specified.";return U.isString(t)?this.nodes.find(function(n){return n.id==t}):this.hasNode(t)?t:null},hasNode:function(t){if(U.isString(t))return this.nodes.any(function(n){return n.id===t});if(U.isObject(t))return this.nodes.any(function(n){return n===t});throw"The identifier should be a Node or the Id (string) of a node."},removeNode:function(t){var n,i,e,s,h=t;if(U.isString(t)&&(h=this.getNode(t)),!U.isDefined(h))throw"The identifier should be a Node or the Id (string) of a node.";for(n=h.links,h.links=[],i=0,e=n.length;e>i;i++)s=n[i],this.removeLink(s);this.nodes.remove(h)},areConnected:function(t,n){return this.links.any(function(i){return i.source==t&&i.target==n||i.source==n&&i.target==t})},removeLink:function(t){this.links.remove(t),t.source.outgoing.remove(t),t.source.links.remove(t),t.target.incoming.remove(t),t.target.links.remove(t)},addNode:function(t,n,i){var e=null;if(!U.isDefined(t))throw"No Node or identifier for a new Node is given.";if(U.isString(t)){if(this.hasNode(t))return this.getNode(t);e=new v(t)}else{if(this.hasNode(t))return this.getNode(t);e=t}return U.isDefined(n)&&e.bounds(n),U.isDefined(i)&&(e.owner=i),this.nodes.add(e),e},addNodeAndOutgoings:function(t){this.nodes.contains(t)||this.nodes.push(t);var n=t.outgoing;t.outgoing=[],n.forEach(function(t){this.addExistingLink(t)},this)},setItemIndices:function(){var t;for(t=0;t<this.nodes.length;++t)this.nodes[t].index=t;for(t=0;t<this.links.length;++t)this.links[t].index=t},clone:function(t){var n,i=new k,e=U.isDefined(t)&&t===!0;return e&&(i.nodeMap=new m,i.linkMap=new m),n=new m,this.nodes.forEach(function(t){var s=t.clone();n.set(t,s),i.nodes.push(s),e&&i.nodeMap.set(s,t)}),this.links.forEach(function(t){if(n.containsKey(t.source)&&n.containsKey(t.target)){var s=i.addLink(n.get(t.source),n.get(t.target));e&&i.linkMap.set(s,t)}}),i},linearize:function(t){return k.Utils.linearize(this,t)},depthFirstTraversal:function(t,n){var i,e;if(U.isUndefined(t))throw"You need to supply a starting node.";if(U.isUndefined(n))throw"You need to supply an action.";if(!this.hasNode(t))throw"The given start-node is not part of this graph";i=this.getNode(t),e=[],this._dftIterator(i,n,e)},_dftIterator:function(t,n,i){var e,s,h,r;for(n(t),i.add(t),e=t.getChildren(),s=0,h=e.length;h>s;s++)r=e[s],i.contains(r)||this._dftIterator(r,n,i)},breadthFirstTraversal:function(t,n){var i,e,s,h,r,o,a,d;if(U.isUndefined(t))throw"You need to supply a starting node.";if(U.isUndefined(n))throw"You need to supply an action.";if(!this.hasNode(t))throw"The given start-node is not part of this graph";for(i=this.getNode(t),e=new p,s=[],e.enqueue(i);e.length>0;)for(h=e.dequeue(),n(h),s.add(h),r=h.getChildren(),o=0,a=r.length;a>o;o++)d=r[o],s.contains(d)||e.contains(d)||e.enqueue(d)},_stronglyConnectedComponents:function(t,n,i,e,s,h,r){var o,a,d,u,c;for(i.add(n,r),e.add(n,r),r++,h.push(n),a=n.getChildren(),d=0,u=a.length;u>d;d++)o=a[d],i.containsKey(o)?h.contains(o)&&e.add(n,Math.min(e.get(n),i.get(o))):(this._stronglyConnectedComponents(t,o,i,e,s,h,r),e.add(n,Math.min(e.get(n),e.get(o))));if(e.get(n)===i.get(n)){c=[];do o=h.pop(),c.add(o);while(o!==n);(!t||c.length>1)&&s.add(c)}},findCycles:function(t){var n,i,e,s,h,r,o;for(U.isUndefined(t)&&(t=!0),n=new m,i=new m,e=[],s=[],h=0,r=this.nodes.length;r>h;h++)o=this.nodes[h],n.containsKey(o)||this._stronglyConnectedComponents(t,o,n,i,e,s,0);return e},isAcyclic:function(){return this.findCycles().isEmpty()},isSubGraph:function(t){var n=t.linearize(),i=this.linearize();return n.all(function(t){return i.contains(t)})},makeAcyclic:function(){var t,n,i,e,s,h,r,o,a,d,u,c,f,l,g,y,p,w,v,x,k,b,_,N,L,T,U,C,E,M,S,R;if(this.isEmpty()||this.nodes.length<=1||this.links.length<=1)return[];if(2==this.nodes.length){if(t=[],this.links.length>1)for(n=this.links[0],i=n.source,e=0,s=this.links.length;s>e;e++)h=this.links[e],h.source!=i&&(r=h.reverse(),t.add(r));return t}for(o=this.clone(!0),a=this.nodes.length,d=new m,u=function(t){return 0===t.outgoing.length?2-a:0===t.incoming.length?a-2:t.outgoing.length-t.incoming.length},c=function(t,n){var i=u(t,a);n.containsKey(i)||n.set(i,[]),n.get(i).push(t)},o.nodes.forEach(function(t){c(t,d)}),f=[],l=[];o.nodes.length>0;){if(d.containsKey(2-a))for(w=d.get(2-a);w.length>0;){for(y=w.pop(),v=0;v<y.links.length;v++)x=y.links[v],g=x.getComplement(y),p=u(g,a),d.get(p).remove(g),g.removeLink(x),c(g,d);o.nodes.remove(y),l.unshift(y)}if(d.containsKey(a-2))for(k=d.get(a-2);k.length>0;){for(g=k.pop(),b=0;b<g.links.length;b++)_=g.links[b],y=_.getComplement(g),p=u(y,a),d.get(p).remove(y),y.removeLink(_),c(y,d);f.push(g),o.nodes.remove(g)}if(o.nodes.length>0)for(N=a-3;N>2-a;N--)if(d.containsKey(N)&&d.get(N).length>0){for(L=d.get(N),T=L.pop(),U=0;U<T.links.length;U++)C=T.links[U],E=C.getComplement(T),p=u(E,a),d.get(p).remove(E),E.removeLink(C),c(E,d);f.push(T),o.nodes.remove(T);break}}for(f=f.concat(l),M=new m,S=0;S<this.nodes.length;S++)M.set(o.nodeMap.get(f[S]),S);return R=[],this.links.forEach(function(t){M.get(t.source)>M.get(t.target)&&(t.reverse(),R.push(t))}),R}}),k.Predefined={EightGraph:function(){return k.Utils.parse(["1->2","2->3","3->4","4->1","3->5","5->6","6->7","7->3"])},Mindmap:function(){return k.Utils.parse(["0->1","0->2","0->3","0->4","0->5","1->6","1->7","7->8","2->9","9->10","9->11","3->12","12->13","13->14","4->15","4->16","15->17","15->18","18->19","18->20","14->21","14->22","5->23","23->24","23->25","6->26"])},ThreeGraph:function(){return k.Utils.parse(["1->2","2->3","3->1"])},BinaryTree:function(t){return U.isUndefined(t)&&(t=5),k.Utils.createBalancedTree(t,2)},Linear:function(t){return U.isUndefined(t)&&(t=10),k.Utils.createBalancedTree(t,1)},Tree:function(t,n){return k.Utils.createBalancedTree(t,n)},Forest:function(t,n,i){return k.Utils.createBalancedForest(t,n,i)},Workflow:function(){return k.Utils.parse(["0->1","1->2","2->3","1->4","4->3","3->5","5->6","6->3","6->7","5->4"])},Grid:function(t,n){var i,e,s,h,r,o=new _.Graph;if(0>=t&&0>=n)return o;for(i=0;t+1>i;i++)for(e=null,s=0;n+1>s;s++)h=new v(""+i+"."+(""+s)),o.addNode(h),e&&o.addLink(e,h),i>0&&(r=o.getNode(""+(i-1)+"."+(""+s)),o.addLink(r,h)),e=h;return o}},k.Utils={parse:function(t){var n,i,e,s,h,r=new _.Graph,o=t.slice();for(i=0,e=o.length;e>i;i++){if(s=o[i],U.isString(s)){if(s.indexOf("->")<0)throw"The link should be specified as 'a->b'.";if(h=s.split("->"),2!=h.length)throw"The link should be specified as 'a->b'.";n=new x(h[0],h[1]),r.addLink(n)}if(U.isObject(s)){if(!n)throw"Specification found before Link definition.";b.deepExtend(n,s)}}return r},linearize:function(t,n){var i,e,s,h;if(U.isUndefined(t))throw"Expected an instance of a Graph object in slot one.";for(U.isUndefined(n)&&(n=!1),i=[],e=0,s=t.links.length;s>e;e++)h=t.links[e],i.add(h.source.id+"->"+h.target.id),n&&i.add({id:h.id});return i},_addShape:function(t,n,i,e){return U.isUndefined(n)&&(n=new _.Point(0,0)),U.isUndefined(i)&&(i=h()),e=b.deepExtend({width:20,height:20,id:i,radius:10,background:"#778899",data:"circle"},e),t.addShape(n,e)},_addConnection:function(t,n,i,e){return t.connect(n,i,e)},createDiagramFromGraph:function(t,n,i,e){var s,h,r,a,d,u,c,f,l,g,y,m,p,w,v,x;if(U.isUndefined(t))throw"The diagram surface is undefined.";if(U.isUndefined(n))throw"No graph specification defined.";for(U.isUndefined(i)&&(i=!0),U.isUndefined(e)&&(e=!1),s=t.element.clientWidth||200,h=t.element.clientHeight||200,d=[],u=0,c=n.nodes.length;c>u;u++)r=n.nodes[u],f=r.position,U.isUndefined(f)&&(f=U.isDefined(r.x)&&U.isDefined(r.y)?new C(r.x,r.y):new C(U.randomInteger(10,s-20),U.randomInteger(10,h-20))),l={},"0"===r.id||e&&b.deepExtend(l,{width:150*Math.random()+20,height:80*Math.random()+50,data:"rectangle",background:"#778899"}),a=this._addShape(t,f,r.id,l),g=a.bounds(),U.isDefined(g)&&(r.x=g.x,r.y=g.y,r.width=g.width,r.height=g.height),d[r.id]=a;for(y=0;y<n.links.length;y++)m=n.links[y],p=d[m.source.id],U.isUndefined(p)||(w=d[m.target.id],U.isUndefined(w)||this._addConnection(t,p,w,{id:m.id}));if(i)for(v=new b.diagram.SpringLayout(t),v.layoutGraph(n,{limitToView:!1}),x=0;x<n.nodes.length;x++)r=n.nodes[x],a=d[r.id],a.bounds(new o(r.x,r.y,r.width,r.height))},createBalancedTree:function(t,n){var i,e,s,h,r,o,a,d,u,c;if(U.isUndefined(t)&&(t=3),U.isUndefined(n)&&(n=3),e=new _.Graph,s=-1,h=[],0>=t||0>=n)return e;for(r=new v(""+ ++s),e.addNode(r),e.root=r,h.add(r),o=0;t>o;o++){for(i=[],a=0;a<h.length;a++)for(d=h[a],u=0;n>u;u++)c=new v(""+ ++s),e.addLink(d,c),i.add(c);h=i}return e},createBalancedForest:function(t,n,i){var e,s,h,r,o,a,d,u,c,f,l;if(U.isUndefined(t)&&(t=3),U.isUndefined(n)&&(n=3),U.isUndefined(i)&&(i=5),s=new _.Graph,h=-1,r=[],0>=t||0>=n||0>=i)return s;for(o=0;i>o;o++)for(a=new v(""+ ++h),s.addNode(a),r=[a],d=0;t>d;d++){for(e=[],u=0;u<r.length;u++)for(c=r[u],f=0;n>f;f++)l=new v(""+ ++h),s.addLink(c,l),e.add(l);r=e}return s},createRandomConnectedGraph:function(t,n,i){var e,s,h,r,o,a,d,u,c,f;if(U.isUndefined(t)&&(t=40),U.isUndefined(n)&&(n=4),U.isUndefined(i)&&(i=!1),e=new _.Graph,s=-1,0>=t)return e;if(h=new v(""+ ++s),e.addNode(h),1===t)return e;if(t>1){for(r=1;t>r&&(o=e.takeRandomNode([],n),o);r++)a=e.addNode(""+r),e.addLink(o,a);if(!i&&t>1)for(d=U.randomInteger(1,t),u=0;d>u;u++)c=e.takeRandomNode([],n),f=e.takeRandomNode([],n),c&&f&&!e.areConnected(c,f)&&e.addLink(c,f);return e}}},b.deepExtend(_,{init:function(t){b.init(t,b.diagram.ui)},Point:C,Intersect:d,Geometry:g,Rect:o,Size:a,RectAlign:u,Matrix:f,MatrixVector:l,normalVariable:s,randomId:h,Dictionary:m,HashTable:y,Queue:p,Set:w,Node:v,Link:x,Graph:k,PathDefiner:r})}(window.kendo.jQuery)})}("function"==typeof define&&define.amd?define:function(t,n){return n()});